<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeumoCare Hospital Management System</title>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Vue.js 3 -->
   <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    
    
    <style>
        /* ============ MEDICAL BLUE THEME ============ */
        :root {
            --medical-blue: #0077be;
            --medical-dark-blue: #005a9e;
            --medical-light-blue: #e3f2fd;
            --medical-teal: #00838f;
            --medical-green: #2e7d32;
            --medical-red: #c62828;
            --medical-orange: #f57c00;
            --medical-gray: #546e7a;
            --medical-light-gray: #f5f7fa;
            
            --primary-color: var(--medical-blue);
            --primary-dark: var(--medical-dark-blue);
            --primary-light: var(--medical-light-blue);
            --secondary-color: var(--medical-green);
            --danger-color: var(--medical-red);
            --warning-color: var(--medical-orange);
            --info-color: var(--medical-teal);
            --gray-50: #f8f9fa;
            --gray-100: #f1f3f4;
            --gray-200: #e8eaed;
            --gray-300: #dadce0;
            --gray-400: #bdc1c6;
            --gray-500: var(--medical-gray);
            --gray-600: #80868b;
            --gray-700: #5f6368;
            --gray-800: #3c4043;
            --gray-900: #202124;
            
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.15);
            --shadow-xl: 0 20px 60px rgba(0,0,0,0.2);
            
            --border-radius-sm: 6px;
            --border-radius-md: 10px;
            --border-radius-lg: 16px;
            --border-radius-xl: 24px;
            
            --transition-fast: 150ms;
            --transition-normal: 250ms;
            --transition-slow: 350ms;
        }
        /* ADD THIS AT THE TOP OF YOUR STYLES */
[v-cloak] {
  display: none !important;
}

#app[v-cloak] {
  opacity: 0;
}

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            color: var(--gray-900);
            line-height: 1.6;
            min-height: 100vh;
            scroll-behavior: smooth;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            line-height: 1.3;
        }

        /* ============ UTILITY CLASSES ============ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .text-primary { color: var(--primary-color); }
        .text-success { color: var(--secondary-color); }
        .text-danger { color: var(--danger-color); }
        .text-warning { color: var(--warning-color); }
        .text-info { color: var(--info-color); }
        .text-muted { color: var(--gray-600); }

        .bg-primary { background: var(--primary-color); }
        .bg-success { background: var(--secondary-color); }
        .bg-danger { background: var(--danger-color); }
        .bg-warning { background: var(--warning-color); }
        .bg-info { background: var(--info-color); }
        .bg-light { background: var(--gray-50); }

        .shadow-sm { box-shadow: var(--shadow-sm); }
        .shadow-md { box-shadow: var(--shadow-md); }
        .shadow-lg { box-shadow: var(--shadow-lg); }

        .rounded-sm { border-radius: var(--border-radius-sm); }
        .rounded-md { border-radius: var(--border-radius-md); }
        .rounded-lg { border-radius: var(--border-radius-lg); }
        .rounded-xl { border-radius: var(--border-radius-xl); }

        .transition { transition: all var(--transition-normal) ease; }
        .transition-fast { transition: all var(--transition-fast) ease; }
        .transition-slow { transition: all var(--transition-slow) ease; }

        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 0.75rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mt-8 { margin-top: 2rem; }

        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }

        .ml-2 { margin-left: 0.5rem; }

        .w-100 { width: 100%; }
        .h-100 { height: 100%; }

        .flex { display: flex; }
        .grid { display: grid; }
        .hidden { display: none; }
        .block { display: block; }

        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }

        /* ============ MEDICAL PROFESSIONAL BUTTONS ============ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius-md);
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 14px;
            line-height: 1;
            cursor: pointer;
            transition: all var(--transition-normal) ease;
            white-space: nowrap;
            min-height: 44px;
            touch-action: manipulation;
            letter-spacing: 0.3px;
            text-transform: uppercase;
        }

        .btn i { font-size: 14px; }

        .btn-primary {
            background: linear-gradient(135deg, var(--medical-blue), var(--medical-dark-blue));
            color: white;
            box-shadow: 0 4px 12px rgba(0, 119, 190, 0.3);
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--medical-dark-blue), var(--medical-blue));
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 119, 190, 0.4);
        }

        .btn-secondary {
            background: white;
            color: var(--medical-blue);
            border: 2px solid var(--medical-blue);
            box-shadow: 0 2px 8px rgba(0, 119, 190, 0.1);
        }
        .btn-secondary:hover {
            background: var(--medical-light-blue);
            border-color: var(--medical-dark-blue);
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--medical-green), #1b5e20);
            color: white;
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);
        }
        .btn-success:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--medical-red), #b71c1c);
            color: white;
            box-shadow: 0 4px 12px rgba(198, 40, 40, 0.3);
        }
        .btn-danger:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--medical-blue);
            color: var(--medical-blue);
        }
        .btn-outline:hover {
            background: var(--medical-blue);
            color: white;
        }

        .btn-outline-danger {
            background: transparent;
            border: 2px solid var(--medical-red);
            color: var(--medical-red);
        }
        .btn-outline-danger:hover {
            background: var(--medical-red);
            color: white;
        }

        .btn-sm { padding: 8px 16px; font-size: 13px; min-height: 36px; }
        .btn-lg { padding: 14px 28px; font-size: 16px; min-height: 52px; }

        .btn-icon {
            width: 44px;
            height: 44px;
            padding: 0;
            border-radius: 50%;
        }

        /* ============ PROFESSIONAL BADGES ============ */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: white;
            border: 1px solid transparent;
        }

        .badge-primary {
            background: var(--medical-blue);
            border-color: var(--medical-dark-blue);
        }

        .badge-success {
            background: var(--medical-green);
            border-color: #1b5e20;
        }

        .badge-warning {
            background: var(--medical-orange);
            border-color: #e65100;
        }

        .badge-danger {
            background: var(--medical-red);
            border-color: #b71c1c;
        }

        .badge-info {
            background: var(--medical-teal);
            border-color: #006064;
        }

        /* ============ STATUS BADGES ============ */
        .status-available {
            background: linear-gradient(135deg, var(--medical-green), #1b5e20);
            color: white;
        }

        .status-busy {
            background: linear-gradient(135deg, var(--medical-orange), #e65100);
            color: white;
        }

        .status-critical {
            background: linear-gradient(135deg, var(--medical-red), #b71c1c);
            color: white;
        }

        .status-oncall {
            background: linear-gradient(135deg, var(--medical-blue), var(--medical-dark-blue));
            color: white;
        }

        /* ============ PROFESSIONAL CARDS ============ */
        .card {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal) ease;
            border: 1px solid var(--gray-200);
            border-left: 4px solid var(--medical-blue);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--medical-blue), var(--medical-teal));
        }

        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-4px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--medical-light-blue);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: var(--medical-blue);
            font-size: 18px;
            width: 24px;
            text-align: center;
        }

        /* ============ FORMS ============ */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--medical-dark-blue);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-300);
            border-radius: var(--border-radius-md);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            transition: all var(--transition-normal) ease;
            background: white;
            min-height: 44px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--medical-blue);
            box-shadow: 0 0 0 3px rgba(0, 119, 190, 0.1);
        }

        .form-control-sm {
            padding: 10px 12px;
            font-size: 13px;
            min-height: 40px;
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-300);
            border-radius: var(--border-radius-md);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            background: white;
            cursor: pointer;
            min-height: 44px;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%230077be' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--medical-blue);
            box-shadow: 0 0 0 3px rgba(0, 119, 190, 0.1);
        }

        .form-check {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .form-check-input {
            width: 20px;
            height: 20px;
            cursor: pointer;
            min-height: 20px;
            accent-color: var(--medical-blue);
        }

        .form-check-label {
            font-size: 14px;
            color: var(--gray-700);
            cursor: pointer;
            font-weight: 500;
        }

        /* ============ TABLES ============ */
        .table-responsive {
            overflow-x: auto;
            border-radius: var(--border-radius-md);
            background: white;
            box-shadow: var(--shadow-sm);
            -webkit-overflow-scrolling: touch;
            border: 1px solid var(--medical-light-blue);
        }

        .table-responsive::-webkit-scrollbar {
            height: 6px;
        }

        .table-responsive::-webkit-scrollbar-track {
            background: var(--gray-100);
        }

        .table-responsive::-webkit-scrollbar-thumb {
            background: var(--medical-blue);
            border-radius: 3px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .table thead {
            background: linear-gradient(135deg, var(--medical-blue), var(--medical-dark-blue));
        }

        .table th {
            padding: 16px;
            text-align: left;
            color: white;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--gray-200);
        }

        .table tbody tr {
            border-bottom: 1px solid var(--medical-light-blue);
            transition: all var(--transition-fast) ease;
        }

        .table tbody tr:hover {
            background: var(--medical-light-blue);
        }

        .table td {
            padding: 16px;
            font-size: 14px;
            color: var(--gray-700);
            vertical-align: middle;
        }

        /* ============ MODALS ============ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.2s ease-out;
            padding: 20px;
        }

        .modal-container {
            background: white;
            border-radius: var(--border-radius-lg);
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--gray-200);
        }

        .modal-wide {
            max-width: 900px;
        }

        .modal-xwide {
            max-width: 1100px;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            border-bottom: 2px solid var(--medical-light-blue);
            background: linear-gradient(135deg, var(--medical-blue), var(--medical-dark-blue));
            color: white;
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-title i {
            font-size: 20px;
            opacity: 0.9;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            padding: 10px;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast) ease;
            min-height: 44px;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 2px solid var(--medical-light-blue);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background: var(--gray-50);
            border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
            position: sticky;
            bottom: 0;
        }

        /* Modal Tabs */
        .modal-tabs {
            display: flex;
            border-bottom: 2px solid var(--medical-light-blue);
            margin-bottom: 24px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .modal-tabs::-webkit-scrollbar {
            height: 3px;
        }

        .modal-tab {
            padding: 12px 24px;
            border: none;
            background: none;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all var(--transition-fast);
            white-space: nowrap;
            min-height: 44px;
        }

        .modal-tab:hover {
            color: var(--medical-blue);
            background: var(--medical-light-blue);
        }

        .modal-tab.active {
            color: var(--medical-blue);
            border-bottom-color: var(--medical-blue);
            background: var(--medical-light-blue);
        }

        .modal-tab-content {
            display: none;
        }

        .modal-tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Modal Sections */
        .modal-section {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--medical-light-blue);
        }

        .modal-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .modal-section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
        }

        .modal-section-title i {
            font-size: 14px;
            color: var(--medical-blue);
        }

        /* ============ TOASTS ============ */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 99999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: white;
            border-radius: var(--border-radius-md);
            padding: 16px 20px;
            min-width: 300px;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--medical-blue);
            animation: toastSlideIn 0.3s ease;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast-icon {
            font-size: 18px;
            color: var(--medical-blue);
            margin-top: 2px;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
            color: var(--gray-900);
        }

        .toast-message {
            font-size: 13px;
            color: var(--gray-700);
            line-height: 1.4;
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--gray-500);
            font-size: 14px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all var(--transition-fast);
            min-height: 24px;
        }

        .toast-close:hover {
            background: var(--gray-100);
            color: var(--gray-700);
        }

        .toast-success { border-left-color: var(--medical-green); }
        .toast-success .toast-icon { color: var(--medical-green); }

        .toast-error { border-left-color: var(--medical-red); }
        .toast-error .toast-icon { color: var(--medical-red); }

        .toast-warning { border-left-color: var(--medical-orange); }
        .toast-warning .toast-icon { color: var(--medical-orange); }

        /* ============ LOGIN SCREEN ============ */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, var(--medical-dark-blue) 0%, var(--medical-blue) 100%);
        }

        .login-card {
            background: white;
            border-radius: var(--border-radius-xl);
            padding: 48px;
            width: 100%;
            max-width: 500px;
            box-shadow: var(--shadow-xl);
            animation: fadeIn 0.8s ease;
            border: 1px solid var(--medical-light-blue);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .login-logo i {
            font-size: 42px;
            color: var(--medical-blue);
            background: linear-gradient(135deg, var(--medical-blue), var(--medical-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-title {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--medical-blue), var(--medical-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .login-subtitle {
            color: var(--medical-gray);
            font-size: 16px;
            max-width: 400px;
            margin: 0 auto;
            font-weight: 500;
        }

        /* ============ MAIN LAYOUT ============ */
        .app-layout {
            display: flex;
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
        }

        /* ============ MEDICAL SIDEBAR ============ */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--medical-dark-blue) 0%, var(--medical-blue) 100%);
            color: white;
            display: flex;
            flex-direction: column;
            transition: all var(--transition-normal) ease;
            position: fixed;
            height: 100vh;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
        }

        .sidebar-collapsed {
            width: 80px;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.1);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-size: 18px;
        }

        .sidebar-logo i {
            font-size: 24px;
            color: white;
        }

        .sidebar-toggle {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            font-size: 14px;
            cursor: pointer;
            padding: 10px;
            border-radius: 6px;
            transition: all var(--transition-fast) ease;
            min-height: 44px;
            width: 44px;
            height: 44px;
        }

        .sidebar-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .sidebar-nav {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .sidebar-section {
            margin-bottom: 24px;
        }

        .sidebar-section-title {
            padding: 0 24px 12px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 600;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 8px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu-item {
            margin: 4px 0;
        }

        .sidebar-menu-link {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 24px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all var(--transition-fast) ease;
            font-size: 14px;
            font-weight: 500;
            border-left: 3px solid transparent;
            min-height: 48px;
            margin: 0 12px;
            border-radius: 8px;
        }

        .sidebar-menu-link:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateX(4px);
        }

        .sidebar-menu-link.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border-left-color: #4fc3f7;
            box-shadow: 0 4px 12px rgba(79, 195, 247, 0.2);
        }

        .sidebar-menu-link i {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.1);
        }

        .sidebar-user {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4fc3f7, var(--medical-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
            flex-shrink: 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-role {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar-collapsed .sidebar-header {
            justify-content: center;
        }

        .sidebar-collapsed .sidebar-logo span,
        .sidebar-collapsed .sidebar-section-title,
        .sidebar-collapsed .sidebar-menu-link span,
        .sidebar-collapsed .user-info,
        .sidebar-collapsed .sidebar-toggle span {
            display: none;
        }

        .sidebar-collapsed .sidebar-logo,
        .sidebar-collapsed .sidebar-menu-link {
            justify-content: center;
        }

        .sidebar-collapsed .sidebar-menu-link i {
            font-size: 18px;
        }

        /* ============ MAIN CONTENT ============ */
        .main-content {
            flex: 1;
            margin-left: 280px;
            transition: all var(--transition-normal) ease;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .main-content-expanded {
            margin-left: 80px;
        }

        /* ============ TOP NAVBAR ============ */
        .top-navbar {
            background: white;
            padding: 16px 32px;
            box-shadow: 0 2px 8px rgba(0, 119, 190, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 3px solid var(--medical-light-blue);
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .navbar-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--medical-dark-blue);
        }

        .navbar-subtitle {
            font-size: 14px;
            color: var(--medical-gray);
            margin-left: 10px;
            font-weight: 500;
        }

        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 18px;
            color: var(--medical-blue);
            cursor: pointer;
            padding: 12px;
            border-radius: 6px;
            min-height: 44px;
        }

        .mobile-menu-toggle:hover {
            background: var(--medical-light-blue);
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        /* ============ ENHANCED SEARCH ============ */
        .search-container {
            position: relative;
            width: 300px;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 48px;
            border: 2px solid var(--medical-light-blue);
            border-radius: var(--border-radius-md);
            font-size: 14px;
            transition: all var(--transition-normal) ease;
            background: white;
            min-height: 44px;
            font-weight: 500;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--medical-blue);
            background: white;
            box-shadow: 0 0 0 3px rgba(0, 119, 190, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--medical-blue);
            font-size: 16px;
            pointer-events: none;
        }

        .search-scope {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--medical-light-blue);
            border: none;
            color: var(--medical-blue);
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 4px;
            min-height: 32px;
            transition: all var(--transition-fast);
        }

        .search-scope:hover {
            background: var(--medical-blue);
            color: white;
        }

        .search-filters {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .search-filter-btn {
            padding: 6px 12px;
            background: var(--medical-light-blue);
            border: 2px solid var(--medical-light-blue);
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            color: var(--medical-blue);
            cursor: pointer;
            transition: all var(--transition-fast);
            min-height: 32px;
        }

        .search-filter-btn:hover {
            background: var(--medical-blue);
            border-color: var(--medical-blue);
            color: white;
        }

        .search-filter-btn.active {
            background: var(--medical-blue);
            border-color: var(--medical-blue);
            color: white;
        }

        /* ============ CONTENT AREA ============ */
        .content-area {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            background: var(--medical-light-gray);
        }

        /* ============ QUICK ACTIONS ============ */
        .quick-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
            padding: 20px;
            background: white;
            border-radius: var(--border-radius-lg);
            flex-wrap: wrap;
            border: 1px solid var(--medical-light-blue);
            box-shadow: var(--shadow-sm);
        }

        .quick-action-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 20px;
            background: white;
            border: 2px solid var(--medical-light-blue);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 14px;
            font-weight: 600;
            min-height: 48px;
            color: var(--medical-dark-blue);
        }

        .quick-action-btn:hover {
            border-color: var(--medical-blue);
            background: var(--medical-light-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 119, 190, 0.1);
        }

        .quick-action-btn i {
            font-size: 16px;
        }

        /* ============ STATS CARDS ============ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 24px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal) ease;
            border: 1px solid var(--medical-light-blue);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--medical-blue), var(--medical-teal));
        }

        .stat-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-4px);
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: var(--border-radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .stat-icon.primary { background: linear-gradient(135deg, var(--medical-blue), var(--medical-dark-blue)); }
        .stat-icon.success { background: linear-gradient(135deg, var(--medical-green), #1b5e20); }
        .stat-icon.warning { background: linear-gradient(135deg, var(--medical-orange), #e65100); }
        .stat-icon.danger { background: linear-gradient(135deg, var(--medical-red), #b71c1c); }

        .stat-content {
            flex: 1;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--medical-dark-blue);
            line-height: 1;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--medical-gray);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ============ EMPTY STATES ============ */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 64px 24px;
            text-align: center;
            color: var(--medical-gray);
        }

        .empty-state-icon {
            font-size: 56px;
            margin-bottom: 20px;
            color: var(--medical-light-blue);
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--medical-dark-blue);
        }

        .empty-state-description {
            font-size: 15px;
            max-width: 400px;
            margin-bottom: 24px;
            line-height: 1.6;
        }

        /* ============ LOADING STATES ============ */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: inherit;
            z-index: 10;
            backdrop-filter: blur(2px);
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--medical-light-blue);
            border-top-color: var(--medical-blue);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .skeleton {
            background: linear-gradient(90deg, var(--medical-light-blue) 25%, #e3f2fd 50%, var(--medical-light-blue) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--border-radius-md);
        }

        @keyframes skeleton-loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }

        .skeleton-text {
            height: 1em;
            margin-bottom: 0.5em;
        }

        .skeleton-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }

        /* ============ DATA SOURCE INDICATOR ============ */
        .data-source-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: 8px;
            vertical-align: middle;
        }

        .data-source-indicator.live {
            background: var(--medical-green);
            color: white;
        }

        .data-source-indicator.mock {
            background: var(--medical-orange);
            color: white;
        }

        /* ============ ALERT BANNER ============ */
        .alert-banner {
            background: linear-gradient(135deg, var(--medical-red), #b71c1c);
            color: white;
            padding: 16px 24px;
            border-radius: var(--border-radius-md);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 12px rgba(198, 40, 40, 0.2);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-banner-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .alert-banner-icon {
            font-size: 20px;
        }

        .alert-banner-message {
            font-weight: 500;
        }

        .alert-banner-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            min-height: 36px;
            min-width: 36px;
            transition: background var(--transition-fast);
        }

        .alert-banner-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* ============ QUICK STATS SIDEBAR ============ */
        .quick-stats-sidebar {
            position: fixed;
            right: 0;
            top: 80px;
            width: 300px;
            height: calc(100vh - 80px);
            background: white;
            border-left: 1px solid var(--medical-light-blue);
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.1);
            z-index: 90;
            overflow-y: auto;
            padding: 24px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            -webkit-overflow-scrolling: touch;
        }

        .quick-stats-sidebar.open {
            transform: translateX(0);
        }

        .stats-toggle-btn {
            position: fixed;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, var(--medical-blue), var(--medical-dark-blue));
            color: white;
            border: none;
            border-radius: 8px 0 0 8px;
            padding: 16px 8px;
            cursor: pointer;
            z-index: 91;
            box-shadow: -2px 0 10px rgba(0, 119, 190, 0.3);
            min-height: 60px;
            min-width: 44px;
            transition: all var(--transition-normal);
        }

        .stats-toggle-btn:hover {
            background: linear-gradient(135deg, var(--medical-dark-blue), var(--medical-blue));
            padding-right: 12px;
        }

        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--medical-light-blue);
        }

        .stats-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--medical-dark-blue);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-title i {
            font-size: 18px;
            color: var(--medical-blue);
        }

        .stats-close {
            background: var(--medical-light-blue);
            border: none;
            color: var(--medical-blue);
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            min-height: 44px;
            min-width: 44px;
            transition: all var(--transition-fast);
        }

        .stats-close:hover {
            background: var(--medical-blue);
            color: white;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--medical-light-blue);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: 14px;
            color: var(--medical-gray);
            font-weight: 500;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--medical-dark-blue);
        }

        .stat-trend {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 10px;
            margin-left: 8px;
            font-weight: 600;
        }

        .stat-trend.positive {
            background: rgba(46, 125, 50, 0.1);
            color: var(--medical-green);
        }

        .stat-trend.negative {
            background: rgba(198, 40, 40, 0.1);
            color: var(--medical-red);
        }

        /* ============ STAFF PROFILE DESIGN ============ */
        .staff-profile-header {
            display: flex;
            align-items: center;
            gap: 24px;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 2px solid var(--medical-light-blue);
        }

        .staff-avatar-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--medical-blue), var(--medical-dark-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 32px;
            flex-shrink: 0;
            box-shadow: 0 8px 24px rgba(0, 119, 190, 0.3);
        }

        .staff-basic-info {
            flex: 1;
        }

        .staff-name {
            font-size: 28px;
            font-weight: 700;
            color: var(--medical-dark-blue);
            margin-bottom: 4px;
        }

        .staff-title {
            font-size: 16px;
            color: var(--medical-gray);
            margin-bottom: 12px;
            font-weight: 500;
        }

        .staff-status {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .staff-status.active {
            background: var(--medical-green);
            color: white;
        }

        .staff-status.inactive {
            background: var(--medical-gray);
            color: white;
        }

        .staff-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .staff-stat-card {
            background: white;
            border-radius: var(--border-radius-md);
            padding: 20px;
            text-align: center;
            border: 1px solid var(--medical-light-blue);
            transition: all var(--transition-fast);
        }

        .staff-stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 119, 190, 0.1);
        }

        .staff-stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--medical-blue);
            margin-bottom: 4px;
        }

        .staff-stat-label {
            font-size: 12px;
            color: var(--medical-gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .info-section {
            margin-bottom: 32px;
        }

        .info-section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--medical-dark-blue);
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--medical-light-blue);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-section-title i {
            color: var(--medical-blue);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .info-item {
            background: var(--medical-light-blue);
            border-radius: var(--border-radius-md);
            padding: 16px;
        }

        .info-label {
            font-size: 12px;
            color: var(--medical-gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .info-value {
            font-size: 15px;
            color: var(--medical-dark-blue);
            font-weight: 500;
        }

        .info-value.unavailable {
            color: var(--gray-500);
            font-style: italic;
        }

        /* ============ CAPACITY PLANNING ============ */
        .capacity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .capacity-card {
            background: white;
            border-radius: var(--border-radius-md);
            padding: 16px;
            border: 2px solid var(--medical-light-blue);
            transition: all var(--transition-fast);
        }

        .capacity-card:hover {
            border-color: var(--medical-blue);
            transform: translateY(-2px);
        }

        .capacity-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .capacity-unit {
            font-weight: 600;
            color: var(--gray-900);
            font-size: 14px;
        }

        .capacity-status {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 500;
        }

        .capacity-status.low {
            background: rgba(52, 168, 83, 0.1);
            color: var(--medical-green);
        }

        .capacity-status.medium {
            background: rgba(251, 188, 5, 0.1);
            color: var(--medical-orange);
        }

        .capacity-status.high {
            background: rgba(234, 67, 53, 0.1);
            color: var(--medical-red);
        }

        .capacity-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .capacity-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-sm);
            font-size: 14px;
            text-align: center;
            min-height: 36px;
        }

        .capacity-input:focus {
            outline: none;
            border-color: var(--medical-blue);
        }

        .capacity-slash {
            color: var(--gray-400);
            font-weight: 600;
        }

        /* ============ ACTION DROPDOWN ============ */
        .action-dropdown {
            position: relative;
            display: inline-block;
        }

        .action-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background: white;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-lg);
            min-width: 180px;
            z-index: 1000;
            margin-top: 4px;
        }

        .action-menu.show {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        .action-menu-item {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: background-color var(--transition-fast);
            font-size: 13px;
            color: var(--gray-700);
            text-decoration: none;
            min-height: 44px;
            border-bottom: 1px solid var(--gray-100);
        }

        .action-menu-item:last-child {
            border-bottom: none;
        }

        .action-menu-item:hover {
            background-color: var(--medical-light-blue);
        }

        .action-menu-item i {
            width: 16px;
            text-align: center;
            font-size: 14px;
        }

        .action-menu-item.danger {
            color: var(--medical-red);
        }

        .action-menu-item.danger:hover {
            background-color: rgba(198, 40, 40, 0.1);
        }

        /* ============ TRAINING UNITS GRID ============ */
        .training-units-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .training-unit-card {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--medical-light-blue);
            transition: all var(--transition-normal);
            position: relative;
        }

        .training-unit-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .training-unit-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .training-unit-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--medical-dark-blue);
        }

        .training-unit-capacity {
            font-size: 14px;
            color: var(--medical-gray);
        }

        .training-unit-residents {
            margin-top: 16px;
        }

        .resident-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: var(--gray-50);
            border-radius: var(--border-radius-sm);
            margin-bottom: 8px;
        }

        .resident-name {
            font-weight: 500;
            color: var(--gray-800);
        }

        .resident-level {
            font-size: 12px;
            color: var(--medical-gray);
        }

        /* ============ AUDIT LOGS ============ */
        .audit-filters {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            padding: 20px;
            background: white;
            border-radius: var(--border-radius-md);
            border: 1px solid var(--medical-light-blue);
        }

        .audit-log-item {
            padding: 16px;
            border-bottom: 1px solid var(--medical-light-blue);
            background: white;
        }

        .audit-log-item:last-child {
            border-bottom: none;
        }

        .audit-action {
            font-weight: 600;
            color: var(--medical-dark-blue);
            margin-bottom: 4px;
        }

        .audit-details {
            font-size: 13px;
            color: var(--gray-600);
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .audit-timestamp {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: 8px;
        }

        /* ============ PERMISSION MANAGER ============ */
        .permission-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .permission-card {
            background: white;
            border-radius: var(--border-radius-md);
            padding: 20px;
            border: 1px solid var(--medical-light-blue);
        }

        .permission-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .permission-role {
            font-weight: 600;
            color: var(--medical-dark-blue);
        }

        .permission-checkboxes {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* ============ MOBILE RESPONSIVE ============ */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0 !important;
            }
            
            .mobile-menu-toggle {
                display: block;
            }
            
            .search-container {
                width: 200px;
            }

            .quick-stats-sidebar {
                width: 100%;
            }
            
            .modal-container {
                width: 95%;
                margin: 10px;
            }

            .training-units-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .navbar-right {
                flex-direction: column;
                align-items: flex-end;
            }
            
            .search-container {
                width: 100%;
                max-width: 200px;
            }
            
            .content-area {
                padding: 20px;
            }
            
            .quick-actions {
                justify-content: center;
            }
            
            .quick-action-btn {
                flex: 1;
                min-width: 160px;
            }

            .stat-card {
                flex-direction: column;
                text-align: center;
                gap: 16px;
            }

            .stat-icon {
                width: 64px;
                height: 64px;
                font-size: 28px;
            }

            .staff-profile-header {
                flex-direction: column;
                text-align: center;
            }

            .staff-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .staff-avatar-large {
                width: 80px;
                height: 80px;
                font-size: 24px;
            }

            .audit-filters {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .login-card {
                padding: 32px 20px;
            }
            
            .modal-container {
                width: 100%;
                margin: 0;
                border-radius: 0;
                max-height: 100vh;
            }
            
            .modal-overlay {
                padding: 0;
            }
            
            .top-navbar {
                padding: 12px 16px;
            }
            
            .navbar-title {
                font-size: 16px;
            }
            
            .quick-actions {
                flex-direction: column;
            }
            
            .quick-action-btn {
                width: 100%;
            }

            .staff-stats {
                grid-template-columns: 1fr;
            }
        }

        /* ============ CUSTOM SCROLLBAR ============ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--medical-light-blue);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--medical-blue);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--medical-dark-blue);
        }
                /* ============ DRAG AND DROP STYLES ============ */
        .draggable-item {
            cursor: move;
            user-select: none;
            transition: transform var(--transition-fast) ease;
        }

        .draggable-item.dragging {
            opacity: 0.5;
            transform: rotate(3deg);
            box-shadow: var(--shadow-lg);
        }

        .drop-zone {
            border: 2px dashed var(--medical-blue);
            border-radius: var(--border-radius-md);
            padding: 20px;
            text-align: center;
            background: var(--medical-light-blue);
            transition: all var(--transition-normal) ease;
        }

        .drop-zone.active {
            border-color: var(--medical-green);
            background: rgba(46, 125, 50, 0.1);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }

        /* ============ TIMELINE STYLES ============ */
        .timeline-container {
            position: relative;
            padding-left: 30px;
        }

        .timeline-line {
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--medical-light-blue);
        }

        .timeline-item {
            position: relative;
            padding-bottom: 25px;
        }

        .timeline-dot {
            position: absolute;
            left: -24px;
            top: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 0 2px;
        }

        .timeline-dot.primary {
            background: var(--medical-blue);
            box-shadow: 0 0 0 2px var(--medical-blue);
        }

        .timeline-dot.success {
            background: var(--medical-green);
            box-shadow: 0 0 0 2px var(--medical-green);
        }

        .timeline-dot.warning {
            background: var(--medical-orange);
            box-shadow: 0 0 0 2px var(--medical-orange);
        }

        .timeline-dot.info {
            background: var(--medical-teal);
            box-shadow: 0 0 0 2px var(--medical-teal);
        }

        .timeline-content {
            background: var(--medical-light-blue);
            padding: 16px;
            border-radius: var(--border-radius-md);
            margin-bottom: 8px;
            border-left: 4px solid;
        }

        .timeline-content.primary {
            border-left-color: var(--medical-blue);
        }

        .timeline-content.success {
            border-left-color: var(--medical-green);
        }

        .timeline-content.warning {
            border-left-color: var(--medical-orange);
        }

        .timeline-content.info {
            border-left-color: var(--medical-teal);
        }

        /* ============ FILE UPLOAD STYLES ============ */
        .file-upload-zone {
            border: 2px dashed var(--medical-blue);
            border-radius: var(--border-radius-md);
            padding: 40px;
            text-align: center;
            background: var(--medical-light-blue);
            transition: all var(--transition-normal) ease;
            cursor: pointer;
        }

        .file-upload-zone:hover {
            border-color: var(--medical-dark-blue);
            background: rgba(0, 119, 190, 0.05);
        }

        .file-upload-zone.active {
            border-color: var(--medical-green);
            background: rgba(46, 125, 50, 0.1);
        }

        .file-preview {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: white;
            border-radius: var(--border-radius-md);
            border: 1px solid var(--medical-light-blue);
            margin-top: 12px;
        }

        .file-preview-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius-sm);
            background: linear-gradient(135deg, var(--medical-blue), var(--medical-dark-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        /* ============ MULTISELECT STYLES ============ */
        .multiselect-container {
            position: relative;
        }

        .multiselect-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--medical-light-blue);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-md);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            margin-top: 4px;
        }

        .multiselect-option {
            padding: 12px;
            cursor: pointer;
            transition: background var(--transition-fast);
            border-bottom: 1px solid var(--medical-light-blue);
        }

        .multiselect-option:hover {
            background: var(--medical-light-blue);
        }

        .multiselect-option.selected {
            background: var(--medical-blue);
            color: white;
        }

        .multiselect-selected {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .multiselect-tag {
            background: var(--medical-blue);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .multiselect-tag-remove {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 2px;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .multiselect-tag-remove:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* ============ PROGRESS BAR VARIATIONS ============ */
        .progress-bar-thick {
            height: 12px;
            background: var(--medical-light-blue);
            border-radius: 6px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-bar-thin {
            height: 4px;
            background: var(--medical-light-blue);
            border-radius: 2px;
            overflow: hidden;
            margin: 4px 0;
        }

        .progress-bar-rounded {
            height: 20px;
            background: var(--medical-light-blue);
            border-radius: 10px;
            overflow: hidden;
            margin: 12px 0;
        }

        .progress-fill-gradient {
            height: 100%;
            background: linear-gradient(90deg, var(--medical-blue), var(--medical-teal));
            border-radius: inherit;
            transition: width 0.6s ease;
        }

        /* ============ CARD VARIATIONS ============ */
        .card-hover-lift {
            transition: transform var(--transition-normal) ease, box-shadow var(--transition-normal) ease;
        }

        .card-hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .card-border-highlight {
            border-left: 6px solid;
        }

        .card-border-highlight.primary {
            border-left-color: var(--medical-blue);
        }

        .card-border-highlight.success {
            border-left-color: var(--medical-green);
        }

        .card-border-highlight.warning {
            border-left-color: var(--medical-orange);
        }

        .card-border-highlight.danger {
            border-left-color: var(--medical-red);
        }

        .card-glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* ============ STATUS INDICATORS ============ */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.online {
            background: var(--medical-green);
            box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.3);
        }

        .status-indicator.offline {
            background: var(--medical-gray);
            box-shadow: 0 0 0 2px rgba(84, 110, 122, 0.3);
        }

        .status-indicator.busy {
            background: var(--medical-orange);
            box-shadow: 0 0 0 2px rgba(245, 124, 0, 0.3);
        }

        .status-indicator.away {
            background: var(--medical-blue);
            box-shadow: 0 0 0 2px rgba(0, 119, 190, 0.3);
        }

        /* ============ LOADING STATES ENHANCED ============ */
        .loading-pulse {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .loading-skeleton-grid {
            display: grid;
            gap: 16px;
        }

        .loading-skeleton-item {
            background: linear-gradient(90deg, var(--medical-light-blue) 25%, #e3f2fd 50%, var(--medical-light-blue) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--border-radius-md);
        }

        /* ============ TOOLTIP STYLES ============ */
        .tooltip-container {
            position: relative;
            display: inline-block;
        }

        .tooltip {
            position: absolute;
            background: var(--gray-800);
            color: white;
            padding: 8px 12px;
            border-radius: var(--border-radius-sm);
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-fast);
            pointer-events: none;
        }

        .tooltip-container:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        .tooltip-top {
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 8px;
        }

        .tooltip-bottom {
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 8px;
        }

        .tooltip-left {
            right: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-right: 8px;
        }

        .tooltip-right {
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-left: 8px;
        }

        .tooltip-arrow {
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
        }

        .tooltip-top .tooltip-arrow {
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-color: var(--gray-800) transparent transparent transparent;
        }

        .tooltip-bottom .tooltip-arrow {
            bottom: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-color: transparent transparent var(--gray-800) transparent;
        }

        /* ============ BADGE VARIATIONS ============ */
        .badge-outline {
            background: transparent;
            border: 2px solid;
            color: inherit;
        }

        .badge-outline-primary {
            border-color: var(--medical-blue);
            color: var(--medical-blue);
        }

        .badge-outline-success {
            border-color: var(--medical-green);
            color: var(--medical-green);
        }

        .badge-outline-warning {
            border-color: var(--medical-orange);
            color: var(--medical-orange);
        }

        .badge-outline-danger {
            border-color: var(--medical-red);
            color: var(--medical-red);
        }

        .badge-glow {
            box-shadow: 0 0 10px currentColor;
        }

        .badge-icon {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        /* ============ RESPONSIVE ENHANCEMENTS ============ */
        @media (max-width: 768px) {
            .modal-container {
                width: 95%;
                margin: 10px;
            }
            
            .modal-xwide {
                max-width: 95%;
            }
            
            .staff-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .capacity-grid {
                grid-template-columns: 1fr;
            }
            
            .training-units-grid {
                grid-template-columns: 1fr;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .grid.grid-cols-2 {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .modal-container {
                width: 100%;
                margin: 0;
                border-radius: 0;
                max-height: 100vh;
            }
            
            .modal-overlay {
                padding: 0;
            }
            
            .modal-tabs {
                flex-wrap: wrap;
            }
            
            .modal-tab {
                flex: 1;
                min-width: 120px;
                text-align: center;
                padding: 12px 8px;
                font-size: 12px;
            }
            
            .staff-stats {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .staff-profile-header {
                flex-direction: column;
                text-align: center;
                gap: 16px;
            }
            
            .staff-basic-info {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div id="app" v-cloak>

        <!-- ============ TOAST CONTAINER ============ -->
        <div class="toast-container">
            <div v-for="toast in toasts" :key="toast.id" 
                 :class="['toast', `toast-${toast.type}`]" role="alert" aria-live="polite" aria-atomic="true">
                <div class="toast-icon">
                    <i :class="toast.icon"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-title">{{ toast.title }}</div>
                    <div class="toast-message">{{ toast.message }}</div>
                </div>
                <button class="toast-close" @click="removeToast(toast.id)" aria-label="Close notification">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- ============ LOGIN SCREEN ============ -->
        <div v-if="!currentUser" class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <div class="login-logo">
                        <i class="fas fa-lungs"></i>
                        <span class="login-title">NeumoCare</span>
                    </div>
                    <p class="login-subtitle">Pulmonology Department Management System</p>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control" v-model="loginForm.email" placeholder="admin@neumocare.org" aria-required="true">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" v-model="loginForm.password" placeholder="" aria-required="true">
                </div>
                
                <div class="form-group">
                    <label class="form-check">
                        <input type="checkbox" class="form-check-input" v-model="loginForm.remember_me">
                        <span class="form-check-label">Remember me</span>
                    </label>
                </div>
                
                <button class="btn btn-primary btn-lg w-100" @click="handleLogin" :disabled="loading" aria-label="Login to NeumoCare system">
                    <span v-if="loading" class="loading"></span>
                    <span v-else><i class="fas fa-sign-in-alt"></i> Login to NeumoCare</span>
                </button>
                
                <div class="text-center mt-4 text-muted">
                    <small>Demo Credentials: admin@neumocare.org / password123</small>
                </div>
            </div>
        </div>

        <!-- ============ MAIN APPLICATION ============ -->
        <div v-else class="app-layout">
            <!-- Sidebar -->
            <aside class="sidebar" :class="{ 'sidebar-collapsed': sidebarCollapsed, 'mobile-open': mobileMenuOpen }" 
                   aria-label="Main navigation">
                <div class="sidebar-header">
                    <div class="sidebar-logo">
                        <i class="fas fa-lungs"></i>
                        <span>NeumoCare</span>
                    </div>
                    <button class="sidebar-toggle" @click="sidebarCollapsed = !sidebarCollapsed" aria-label="Toggle sidebar">
                        <i class="fas" :class="sidebarCollapsed ? 'fa-chevron-right' : 'fa-chevron-left'"></i>
                    </button>
                </div>
                
                <nav class="sidebar-nav" aria-label="Primary navigation">
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Dashboard</div>
                        <ul class="sidebar-menu">
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'daily_operations' }" 
                                   @click.prevent="switchView('daily_operations'); mobileMenuOpen = false"
                                   aria-label="Dashboard overview" :aria-current="currentView === 'daily_operations' ? 'page' : null">
                                    <i class="fas fa-tachometer-alt"></i>
                                    <span>Overview</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Clinical Operations</div>
                        <ul class="sidebar-menu">
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'medical_staff' }" 
                                   @click.prevent="switchView('medical_staff'); mobileMenuOpen = false" v-if="hasPermission('medical_staff', 'read')"
                                   :aria-current="currentView === 'medical_staff' ? 'page' : null">
                                    <i class="fas fa-user-md"></i>
                                    <span>Medical Staff</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'patient_census' }" 
                                   @click.prevent="switchView('patient_census'); mobileMenuOpen = false" v-if="hasPermission('patient_census', 'read')"
                                   :aria-current="currentView === 'patient_census' ? 'page' : null">
                                    <i class="fas fa-procedures"></i>
                                    <span>Patient Census</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'oncall_schedule' }" 
                                   @click.prevent="switchView('oncall_schedule'); mobileMenuOpen = false" v-if="hasPermission('oncall_schedule', 'read')"
                                   :aria-current="currentView === 'oncall_schedule' ? 'page' : null">
                                    <i class="fas fa-phone-alt"></i>
                                    <span>On-call Schedule</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Training & Education</div>
                        <ul class="sidebar-menu">
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'resident_rotations' }" 
                                   @click.prevent="switchView('resident_rotations'); mobileMenuOpen = false" v-if="hasPermission('resident_rotations', 'read')"
                                   :aria-current="currentView === 'resident_rotations' ? 'page' : null">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>Resident Rotations</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'training_units' }" 
                                   @click.prevent="switchView('training_units'); mobileMenuOpen = false" v-if="hasPermission('training_units', 'read')"
                                   :aria-current="currentView === 'training_units' ? 'page' : null">
                                    <i class="fas fa-clinic-medical"></i>
                                    <span>Training Units</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Administration</div>
                        <ul class="sidebar-menu">
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'staff_absence' }" 
                                   @click.prevent="switchView('staff_absence'); mobileMenuOpen = false" v-if="hasPermission('staff_absence', 'read')"
                                   :aria-current="currentView === 'staff_absence' ? 'page' : null">
                                    <i class="fas fa-calendar-times"></i>
                                    <span>Staff Absence</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'department_management' }" 
                                   @click.prevent="switchView('department_management'); mobileMenuOpen = false" v-if="hasPermission('system', 'manage_departments')"
                                   :aria-current="currentView === 'department_management' ? 'page' : null">
                                    <i class="fas fa-sitemap"></i>
                                    <span>Departments</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'communications' }" 
                                   @click.prevent="switchView('communications'); mobileMenuOpen = false" v-if="hasPermission('communications', 'read')"
                                   :aria-current="currentView === 'communications' ? 'page' : null">
                                    <i class="fas fa-bullhorn"></i>
                                    <span>Communications</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item" v-if="hasPermission('audit', 'read')">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'audit_logs' }" 
                                   @click.prevent="switchView('audit_logs'); mobileMenuOpen = false"
                                   :aria-current="currentView === 'audit_logs' ? 'page' : null">
                                    <i class="fas fa-history"></i>
                                    <span>Audit Logs</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item" v-if="hasPermission('permissions', 'manage')">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'permission_manager' }" 
                                   @click.prevent="switchView('permission_manager'); mobileMenuOpen = false"
                                   :aria-current="currentView === 'permission_manager' ? 'page' : null">
                                    <i class="fas fa-user-shield"></i>
                                    <span>Permission Manager</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item" v-if="hasPermission('system', 'read')">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'system_settings' }" 
                                   @click.prevent="switchView('system_settings'); mobileMenuOpen = false"
                                   :aria-current="currentView === 'system_settings' ? 'page' : null">
                                    <i class="fas fa-cog"></i>
                                    <span>System Settings</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </nav>
                
                <div class="sidebar-footer">
                    <div class="sidebar-user">
                        <div class="user-avatar" aria-hidden="true">{{ getInitials(currentUser.full_name) }}</div>
                        <div class="user-info">
                            <div class="user-name">{{ currentUser.full_name }}</div>
                            <div class="user-role">{{ getUserRoleDisplay(currentUser.user_role) }}</div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Quick Stats Sidebar -->
            <button class="stats-toggle-btn" @click="toggleStatsSidebar" :aria-label="statsSidebarOpen ? 'Close statistics sidebar' : 'Open statistics sidebar'">
                <i class="fas" :class="statsSidebarOpen ? 'fa-chevron-right' : 'fa-chevron-left'"></i>
            </button>
            
            <div class="quick-stats-sidebar" :class="{ open: statsSidebarOpen }" role="complementary" aria-label="Live statistics">
                <div class="stats-header">
                    <div class="stats-title">
                        <i class="fas fa-chart-line"></i>
                        Live Statistics
                    </div>
                    <button class="stats-close" @click="statsSidebarOpen = false" aria-label="Close statistics">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">Department Occupancy</span>
                    <div v-if="loadingStats" class="skeleton skeleton-text" style="width: 60px;"></div>
                    <template v-else>
                        <span class="stat-value">{{ liveStats.occupancy || 0 }}%</span>
                        <span class="stat-trend" :class="liveStats.occupancyTrend > 0 ? 'positive' : 'negative'">
                            {{ liveStats.occupancyTrend > 0 ? '' : '' }}{{ Math.abs(liveStats.occupancyTrend || 0) }}%
                        </span>
                    </template>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">On-duty Staff</span>
                    <div v-if="loadingStats" class="skeleton skeleton-text" style="width: 40px;"></div>
                    <template v-else>
                        <span class="stat-value">{{ liveStats.onDutyStaff || 0 }}</span>
                        <span class="stat-trend" :class="liveStats.staffTrend > 0 ? 'positive' : 'negative'">
                            {{ liveStats.staffTrend > 0 ? '' : '' }}{{ Math.abs(liveStats.staffTrend || 0) }}
                        </span>
                    </template>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">Pending Requests</span>
                    <div v-if="loadingStats" class="skeleton skeleton-text" style="width: 30px;"></div>
                    <template v-else>
                        <span class="stat-value">{{ liveStats.pendingRequests || 0 }}</span>
                    </template>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">ER Capacity</span>
                    <div v-if="loadingStats" class="skeleton skeleton-text" style="width: 80px;"></div>
                    <template v-else>
                        <span class="stat-value">{{ liveStats.erCapacity?.current || 0 }}/{{ liveStats.erCapacity?.max || 0 }}</span>
                        <span class="stat-trend" :class="liveStats.erCapacity?.status || ''">{{ liveStats.erCapacity?.status || 'normal' }}</span>
                    </template>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">ICU Capacity</span>
                    <div v-if="loadingStats" class="skeleton skeleton-text" style="width: 80px;"></div>
                    <template v-else>
                        <span class="stat-value">{{ liveStats.icuCapacity?.current || 0 }}/{{ liveStats.icuCapacity?.max || 0 }}</span>
                        <span class="stat-trend" :class="liveStats.icuCapacity?.status || ''">{{ liveStats.icuCapacity?.status || 'normal' }}</span>
                    </template>
                </div>
            </div>

            <!-- Main Content -->
            <main class="main-content" :class="{ 'main-content-expanded': sidebarCollapsed }">
                <!-- Top Navbar -->
                <header class="top-navbar">
                    <div class="navbar-left">
                        <button class="mobile-menu-toggle" @click="mobileMenuOpen = !mobileMenuOpen" aria-label="Toggle mobile menu">
                            <i class="fas fa-bars"></i>
                        </button>
                        <div>
                            <span class="navbar-title">{{ getCurrentTitle() }}</span>
                            <span class="navbar-subtitle">{{ getCurrentSubtitle() }}</span>
                        </div>
                    </div>
                    
                    <div class="navbar-right">
                        <!-- Enhanced Search -->
                        <div class="search-container">
                            <div class="search-box">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="search-input" :placeholder="getSearchPlaceholder()" 
                                       v-model="searchQuery" @keyup.enter="handleSearch"
                                       aria-label="Search">
                                <button class="search-scope" @click="toggleSearchScope" aria-label="Change search scope">
                                    {{ searchScope }} <i class="fas fa-chevron-down ml-2"></i>
                                </button>
                            </div>
                            
                            <div class="search-filters">
                                <button class="search-filter-btn" :class="{ active: searchFilter === 'all' }" 
                                        @click="setSearchFilter('all')">All</button>
                                <button class="search-filter-btn" :class="{ active: searchFilter === 'staff' }" 
                                        @click="setSearchFilter('staff')">Staff</button>
                                <button class="search-filter-btn" :class="{ active: searchFilter === 'patients' }" 
                                        @click="setSearchFilter('patients')">Patients</button>
                                <button class="search-filter-btn" :class="{ active: searchFilter === 'units' }" 
                                        @click="setSearchFilter('units')">Units</button>
                            </div>
                        </div>
                        
                        <div class="navbar-actions" style="display: flex; align-items: center; gap: 12px;">
                            <div class="notification-badge">
                                <button class="btn btn-icon btn-secondary" @click="showNotifications" 
                                        :aria-label="`${unreadNotifications} unread notifications`">
                                    <i class="fas fa-bell"></i>
                                    <span class="badge badge-danger" v-if="unreadNotifications > 0" style="position: absolute; top: -8px; right: -8px; min-width: 20px; height: 20px; padding: 2px 6px; font-size: 10px;">
                                        {{ unreadNotifications }}
                                    </span>
                                </button>
                            </div>
                            
                            <button class="btn btn-icon btn-secondary" @click="showCommunicationsModal" 
                                    v-if="hasPermission('communications', 'create')" aria-label="Communications">
                                <i class="fas fa-bullhorn"></i>
                            </button>
                            
                            <div class="user-menu" style="position: relative;">
                                <button class="user-menu-toggle" @click="toggleUserMenu" :aria-label="`${currentUser.full_name} profile menu`" style="display: flex; align-items: center; gap: 8px; background: none; border: none; cursor: pointer; padding: 8px; border-radius: var(--border-radius-md); transition: background var(--transition-fast); min-height: 44px;">
                                    <div class="user-avatar">{{ getInitials(currentUser.full_name) }}</div>
                                    <i class="fas fa-chevron-down" style="font-size: 12px;"></i>
                                </button>
                                
                                <div class="action-menu" v-if="userMenuOpen" style="position: absolute; right: 0; top: 100%; margin-top: 8px; min-width: 200px;">
                                    <div class="action-menu-item" @click="showUserProfile">
                                        <i class="fas fa-user"></i>
                                        <span>Profile Settings</span>
                                    </div>
                                    <div class="action-menu-item" @click="showSystemSettingsModal" v-if="hasPermission('system', 'read')">
                                        <i class="fas fa-cog"></i>
                                        <span>System Settings</span>
                                    </div>
                                    <div class="action-menu-item" @click="showPermissionManager" v-if="hasPermission('permissions', 'manage')">
                                        <i class="fas fa-user-shield"></i>
                                        <span>Permission Manager</span>
                                    </div>
                                    <div class="action-menu-item danger" @click="handleLogout">
                                        <i class="fas fa-sign-out-alt"></i>
                                        <span>Logout</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Content Area -->
                <div class="content-area">
                    <!-- Dynamic Alert Banner -->
                    <div v-if="activeAlerts.length > 0" class="alert-banner">
                        <div class="alert-banner-content">
                            <i class="fas fa-exclamation-triangle alert-banner-icon"></i>
                            <span class="alert-banner-message">
                                {{ activeAlerts[0].message }}
                                <span v-if="activeAlerts.length > 1"> (and {{ activeAlerts.length - 1 }} more)</span>
                            </span>
                        </div>
                        <button class="alert-banner-close" @click="dismissAlert(activeAlerts[0].id)" aria-label="Dismiss alert">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <!-- Breadcrumb Navigation -->
                    <nav class="breadcrumb" style="display: flex; align-items: center; gap: 8px; margin-bottom: 24px; padding: 12px 0; border-bottom: 2px solid var(--medical-light-blue); flex-wrap: wrap;" aria-label="Breadcrumb">
                        <div class="breadcrumb-item" @click="switchView('daily_operations')" style="cursor: pointer; display: flex; align-items: center; gap: 8px; color: var(--medical-gray); font-size: 14px; transition: color var(--transition-fast); text-decoration: none; padding: 4px 8px; border-radius: 4px;">
                            <i class="fas fa-home"></i>
                            <span>Dashboard</span>
                        </div>
                        <div class="breadcrumb-separator" style="color: var(--gray-400);">/</div>
                        <div class="breadcrumb-item active" style="display: flex; align-items: center; gap: 8px; color: var(--medical-blue); font-size: 14px; font-weight: 500; padding: 4px 8px;" aria-current="page">
                            {{ getCurrentTitle() }}
                        </div>
                    </nav>

                    <!-- Daily Operations View -->
                    <div v-if="currentView === 'daily_operations'">
                        <!-- Quick Actions -->
                        <div class="quick-actions">
                            <div class="quick-action-btn" @click="showAddMedicalStaffModal" v-if="hasPermission('medical_staff', 'create')">
                                <i class="fas fa-user-plus" style="color: var(--medical-green);"></i>
                                Add Medical Staff
                            </div>
                            <div class="quick-action-btn" @click="showAddOnCallModal" v-if="hasPermission('oncall_schedule', 'create')">
                                <i class="fas fa-phone-alt" style="color: var(--medical-blue);"></i>
                                Schedule On-call
                            </div>
                            <div class="quick-action-btn" @click="showAddAbsenceModal" v-if="hasPermission('staff_absence', 'create')">
                                <i class="fas fa-calendar-times" style="color: var(--medical-orange);"></i>
                                Document Absence
                            </div>
                            <div class="quick-action-btn" @click="showQuickPlacementModal" v-if="hasPermission('placements', 'create')">
                                <i class="fas fa-user-md" style="color: var(--medical-teal);"></i>
                                Quick Placement
                            </div>
                            <div class="quick-action-btn" @click="showAddRotationModal" v-if="hasPermission('resident_rotations', 'create')">
                                <i class="fas fa-calendar-alt" style="color: var(--medical-blue);"></i>
                                Add Rotation
                            </div>
                            <div class="quick-action-btn" @click="showCommunicationsModal" v-if="hasPermission('communications', 'create')">
                                <i class="fas fa-bullhorn" style="color: var(--medical-red);"></i>
                                Post Announcement
                            </div>
                        </div>

                        <!-- Stats Overview -->
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon primary">
                                    <i class="fas fa-user-md"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value">
                                        <span v-if="loadingStats" class="skeleton skeleton-text" style="width: 60px; display: inline-block;"></span>
                                        <span v-else>{{ stats.totalStaff || 0 }}</span>
                                    </div>
                                    <div class="stat-label">Total Medical Staff</div>
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon success">
                                    <i class="fas fa-procedures"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value">
                                        <span v-if="loadingStats" class="skeleton skeleton-text" style="width: 60px; display: inline-block;"></span>
                                        <span v-else>{{ stats.activePatients || 0 }}</span>
                                    </div>
                                    <div class="stat-label">Active Patients</div>
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon warning">
                                    <i class="fas fa-calendar-check"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value">
                                        <span v-if="loadingStats" class="skeleton skeleton-text" style="width: 60px; display: inline-block;"></span>
                                        <span v-else>{{ stats.todayAppointments || 0 }}</span>
                                    </div>
                                    <div class="stat-label">Today's Appointments</div>
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon danger">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value">
                                        <span v-if="loadingStats" class="skeleton skeleton-text" style="width: 60px; display: inline-block;"></span>
                                        <span v-else>{{ stats.pendingAlerts || 0 }}</span>
                                    </div>
                                    <div class="stat-label">Pending Alerts</div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Announcements -->
                        <div class="card mb-6">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-bullhorn"></i>
                                    Recent Announcements
                                </div>
                                <button class="btn btn-sm btn-primary" @click="showCommunicationsModal" v-if="hasPermission('communications', 'create')">
                                    <i class="fas fa-plus"></i> New Announcement
                                </button>
                            </div>
                            <div class="card-content">
                                <div v-if="loadingAnnouncements" class="loading-overlay">
                                    <div class="loading-spinner"></div>
                                </div>
                                <div v-else-if="recentAnnouncements.length === 0" class="empty-state">
                                    <i class="fas fa-bullhorn empty-state-icon"></i>
                                    <div class="empty-state-title">No Announcements</div>
                                    <div class="empty-state-description">
                                        No announcements have been posted yet.
                                    </div>
                                    <button class="btn btn-primary mt-4" @click="showCommunicationsModal" v-if="hasPermission('communications', 'create')">
                                        <i class="fas fa-plus"></i> Create Announcement
                                    </button>
                                </div>
                                <div v-else>
                                    <div v-for="announcement in recentAnnouncements.slice(0, 3)" :key="announcement.id" style="margin-bottom: 16px; padding: 16px; border: 1px solid var(--medical-light-blue); border-radius: var(--border-radius-md); transition: all var(--transition-fast);" @mouseenter="this.style.backgroundColor='var(--medical-light-blue)'" @mouseleave="this.style.backgroundColor='white'">
                                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                                            <div>
                                                <div style="font-weight: 600; color: var(--medical-dark-blue);">{{ announcement.title }}</div>
                                                <div style="font-size: 12px; color: var(--medical-gray);">By: {{ announcement.author }}  {{ formatTimeAgo(announcement.created_at) }}</div>
                                            </div>
                                            <span class="badge" :class="`badge-${announcement.priority}`">
                                                {{ announcement.priority }}
                                            </span>
                                        </div>
                                        <p style="color: var(--gray-700); margin-bottom: 12px;">{{ announcement.content }}</p>
                                        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: var(--gray-500);">
                                            <span>Expires: {{ announcement.expires_at ? formatDateTime(announcement.expires_at) : 'Never' }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Today's On-call Schedule -->
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-phone-alt"></i>
                                    Today's On-call Schedule
                                </div>
                                <button class="btn btn-sm btn-primary" @click="showAddOnCallModal" v-if="hasPermission('oncall_schedule', 'create')">
                                    <i class="fas fa-plus"></i> Add Schedule
                                </button>
                            </div>
                            <div class="card-content">
                                <div v-if="loadingSchedule" class="loading-overlay">
                                    <div class="loading-spinner"></div>
                                </div>
                                <div v-else-if="todaysOnCall.length === 0" class="empty-state">
                                    <i class="fas fa-phone-slash empty-state-icon"></i>
                                    <div class="empty-state-title">No On-call Scheduled</div>
                                    <div class="empty-state-description">
                                        No physicians are scheduled for on-call duty today
                                    </div>
                                    <button class="btn btn-primary mt-4" @click="showAddOnCallModal" v-if="hasPermission('oncall_schedule', 'create')">
                                        <i class="fas fa-plus"></i> Schedule On-call
                                    </button>
                                </div>
                                <div v-else class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Physician</th>
                                                <th>Shift Time</th>
                                                <th>Role</th>
                                                <th>Contact</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="schedule in todaysOnCall" :key="schedule.id">
                                                <td>{{ schedule.physician_name }}</td>
                                                <td>{{ formatTimeRange(schedule.start_time, schedule.end_time) }}</td>
                                                <td>
                                                    <span class="badge badge-primary">{{ schedule.role }}</span>
                                                </td>
                                                <td>{{ schedule.contact_number || 'N/A' }}</td>
                                                <td>
                                                    <div class="action-dropdown">
                                                        <button class="btn btn-sm btn-secondary" @click="toggleActionMenu($event)" aria-label="Schedule actions">
                                                            <i class="fas fa-ellipsis-v"></i>
                                                        </button>
                                                        <div class="action-menu">
                                                            <div class="action-menu-item" @click="editOnCallSchedule(schedule)" v-if="hasPermission('oncall_schedule', 'update')">
                                                                <i class="fas fa-edit"></i>
                                                                <span>Edit</span>
                                                            </div>
                                                            <div class="action-menu-item danger" @click="deleteOnCallSchedule(schedule.id)" v-if="hasPermission('oncall_schedule', 'delete')">
                                                                <i class="fas fa-trash"></i>
                                                                <span>Delete</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Medical Staff View -->
                    <div v-if="currentView === 'medical_staff'">
                        <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <div>
                                <h2 class="section-title" style="font-size: 24px; font-weight: 600; color: var(--medical-dark-blue);">Medical Staff Management</h2>
                                <p class="text-muted" style="color: var(--medical-gray);">Manage all medical staff with comprehensive profiles</p>
                            </div>
                            <button class="btn btn-primary" @click="showAddMedicalStaffModal" 
                                    v-if="hasPermission('medical_staff', 'create')">
                                <i class="fas fa-plus"></i> Add Medical Staff
                            </button>
                        </div>

                        <!-- Filters -->
                        <div class="filter-bar" style="display: flex; gap: 12px; align-items: center; padding: 16px; background: white; border-radius: var(--border-radius-md); margin-bottom: 20px; flex-wrap: wrap; border: 1px solid var(--medical-light-blue);">
                            <div class="filter-group" style="display: flex; flex-direction: column; gap: 4px; min-width: 180px; flex: 1;">
                                <div class="filter-label" style="font-size: 12px; color: var(--medical-gray); font-weight: 500;">Search</div>
                                <input type="text" class="form-control form-control-sm" v-model="staffSearch" placeholder="Name, ID, or email...">
                            </div>
                            <div class="filter-group" style="display: flex; flex-direction: column; gap: 4px; min-width: 180px; flex: 1;">
                                <div class="filter-label" style="font-size: 12px; color: var(--medical-gray); font-weight: 500;">Staff Type</div>
                                <select class="form-select form-select-sm" v-model="staffFilter.staff_type">
                                    <option value="">All Types</option>
                                    <option value="medical_resident">Medical Resident</option>
                                    <option value="attending_physician">Attending Physician</option>
                                    <option value="fellow">Fellow</option>
                                    <option value="nurse_practitioner">Nurse Practitioner</option>
                                </select>
                            </div>
                            <div class="filter-group" style="display: flex; flex-direction: column; gap: 4px; min-width: 180px; flex: 1;">
                                <div class="filter-label" style="font-size: 12px; color: var(--medical-gray); font-weight: 500;">Status</div>
                                <select class="form-select form-select-sm" v-model="staffFilter.employment_status">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="on_leave">On Leave</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                            <div class="filter-actions" style="display: flex; gap: 8px; margin-left: auto;">
                                <button class="btn btn-sm btn-secondary" @click="resetStaffFilters">
                                    <i class="fas fa-redo"></i> Reset
                                </button>
                                <button class="btn btn-sm btn-primary" @click="applyStaffFilters">
                                    <i class="fas fa-filter"></i> Apply
                                </button>
                            </div>
                        </div>

                        <!-- Staff Table -->
                        <div class="card">
                            <div v-if="loadingStaff" class="loading-overlay">
                                <div class="loading-spinner"></div>
                            </div>
                            <div v-else-if="filteredMedicalStaff.length === 0" class="empty-state">
                                <i class="fas fa-user-md empty-state-icon"></i>
                                <div class="empty-state-title">No Medical Staff Found</div>
                                <div class="empty-state-description">
                                    Try adjusting your filters or add new medical staff to get started.
                                </div>
                                <button class="btn btn-primary mt-4" @click="showAddMedicalStaffModal" v-if="hasPermission('medical_staff', 'create')">
                                    <i class="fas fa-plus"></i> Add Medical Staff
                                </button>
                            </div>
                            <div v-else class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Staff Type</th>
                                            <th>Staff ID</th>
                                            <th>Department</th>
                                            <th>Status</th>
                                            <th>Last Active</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="staff in filteredMedicalStaff" :key="staff.id">
                                            <td style="cursor: pointer;" @click="viewStaffDetails(staff)">
                                                <div class="flex items-center gap-3" style="display: flex; align-items: center; gap: 12px;">
                                                    <div class="user-avatar" aria-hidden="true">{{ getInitials(staff.full_name) }}</div>
                                                    <div>
                                                        <div class="font-medium" style="font-weight: 500; color: var(--medical-dark-blue);">{{ staff.full_name }}</div>
                                                        <div class="text-sm text-gray-500">{{ staff.professional_email }}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge" :class="getStaffTypeClass(staff.staff_type)">
                                                    {{ formatStaffType(staff.staff_type) }}
                                                </span>
                                            </td>
                                            <td>{{ staff.staff_id }}</td>
                                            <td>{{ getDepartmentName(staff.department_id) || 'Unassigned' }}</td>
                                            <td>
                                                <span class="badge" :class="staff.employment_status === 'active' ? 'status-available' : staff.employment_status === 'on_leave' ? 'status-busy' : 'status-critical'">
                                                    {{ formatEmploymentStatus(staff.employment_status) }}
                                                </span>
                                            </td>
                                            <td>
                                                <span class="updated-timestamp" style="font-size: 12px; color: var(--medical-gray); display: flex; align-items: center; gap: 4px;">
                                                    <i class="fas fa-clock"></i> {{ formatTimeAgo(staff.last_activity) }}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="action-dropdown">
                                                    <button class="btn btn-sm btn-secondary" @click="toggleActionMenu($event)" aria-label="Staff actions">
                                                        <i class="fas fa-ellipsis-v"></i>
                                                    </button>
                                                    <div class="action-menu">
                                                        <div class="action-menu-item" @click="viewStaffDetails(staff)">
                                                            <i class="fas fa-eye"></i>
                                                            <span>View Profile</span>
                                                        </div>
                                                        <div class="action-menu-item" @click="editMedicalStaff(staff)" v-if="hasPermission('medical_staff', 'update')">
                                                            <i class="fas fa-edit"></i>
                                                            <span>Edit</span>
                                                        </div>
                                                        <div class="action-menu-item" @click="assignRotationToStaff(staff)" v-if="hasPermission('resident_rotations', 'create') && staff.staff_type === 'medical_resident'">
                                                            <i class="fas fa-calendar-alt"></i>
                                                            <span>Assign Rotation</span>
                                                        </div>
                                                        <div class="action-menu-item danger" @click="deleteMedicalStaff(staff.id)" v-if="hasPermission('medical_staff', 'delete')">
                                                            <i class="fas fa-trash"></i>
                                                            <span>Delete</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Department Management View -->
                    <div v-if="currentView === 'department_management'">
                        <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <div>
                                <h2 class="section-title" style="font-size: 24px; font-weight: 600; color: var(--medical-dark-blue);">Department Management</h2>
                                <p class="text-muted" style="color: var(--medical-gray);">Manage departments and clinical units for organizational structure</p>
                            </div>
                            <div class="flex gap-2" style="display: flex; gap: 8px;">
                                <button class="btn btn-primary" @click="showAddDepartmentModal" 
                                        v-if="hasPermission('system', 'manage_departments')">
                                    <i class="fas fa-plus"></i> Add Department
                                </button>
                                <button class="btn btn-success" @click="showAddClinicalUnitModal" 
                                        v-if="hasPermission('system', 'manage_departments')">
                                    <i class="fas fa-plus"></i> Add Clinical Unit
                                </button>
                            </div>
                        </div>

                        <!-- Departments Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; margin-bottom: 32px;">
                            <div v-for="department in departments" :key="department.id" class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-hospital"></i>
                                        {{ department.name }}
                                    </div>
                                    <span class="badge" :class="department.status === 'active' ? 'status-available' : 'status-busy'">
                                        {{ department.status }}
                                    </span>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="text-sm text-gray-600 mb-2">Department Code: {{ department.code }}</div>
                                    <div class="text-sm text-gray-600 mb-4">{{ department.description || 'No description available' }}</div>
                                    
                                    <div class="mt-3">
                                        <div class="text-sm font-medium mb-2">Associated Clinical Units:</div>
                                        <div class="flex flex-wrap gap-2">
                                            <span v-for="unit in getDepartmentUnits(department.id)" :key="unit.id" 
                                                  style="background: var(--medical-light-blue); color: var(--medical-blue); font-size: 12px; padding: 4px 12px; border-radius: 20px;">
                                                {{ unit.name }}
                                            </span>
                                            <span v-if="getDepartmentUnits(department.id).length === 0" class="text-gray-500 text-sm">
                                                No units assigned
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex gap-2" style="display: flex; gap: 8px;">
                                    <button class="btn btn-sm btn-primary flex-1" @click="editDepartment(department)"
                                            v-if="hasPermission('system', 'manage_departments')">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <div class="action-dropdown">
                                        <button class="btn btn-sm btn-secondary" @click="toggleActionMenu($event)" aria-label="Department actions">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                        <div class="action-menu">
                                            <div class="action-menu-item" @click="viewDepartmentDetails(department)">
                                                <i class="fas fa-eye"></i>
                                                <span>View Details</span>
                                            </div>
                                            <div class="action-menu-item danger" @click="deleteDepartment(department.id)" v-if="hasPermission('system', 'manage_departments')">
                                                <i class="fas fa-trash"></i>
                                                <span>Delete</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Clinical Units Table -->
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-clinic-medical"></i>
                                    All Clinical Units
                                </div>
                            </div>
                            <div v-if="loading" class="loading-overlay">
                                <div class="loading-spinner"></div>
                            </div>
                            <div v-else-if="clinicalUnits.length === 0" class="empty-state">
                                <i class="fas fa-clinic-medical empty-state-icon"></i>
                                <div class="empty-state-title">No Clinical Units</div>
                                <div class="empty-state-description">
                                    No clinical units have been created yet.
                                </div>
                                <button class="btn btn-primary mt-4" @click="showAddClinicalUnitModal" v-if="hasPermission('system', 'manage_departments')">
                                    <i class="fas fa-plus"></i> Add Clinical Unit
                                </button>
                            </div>
                            <div v-else class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Unit Name</th>
                                            <th>Unit Code</th>
                                            <th>Department</th>
                                            <th>Type</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="unit in clinicalUnits" :key="unit.id">
                                            <td>{{ unit.name }}</td>
                                            <td>{{ unit.code }}</td>
                                            <td>{{ getDepartmentName(unit.department_id) }}</td>
                                            <td>
                                                <span class="badge" :class="unit.unit_type === 'clinical' ? 'badge-primary' : 'badge-info'">
                                                    {{ unit.unit_type }}
                                                </span>
                                            </td>
                                            <td>
                                                <span class="badge" :class="unit.status === 'active' ? 'status-available' : 'status-busy'">
                                                    {{ unit.status }}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="action-dropdown">
                                                    <button class="btn btn-sm btn-secondary" @click="toggleActionMenu($event)" aria-label="Unit actions">
                                                        <i class="fas fa-ellipsis-v"></i>
                                                    </button>
                                                    <div class="action-menu">
                                                        <div class="action-menu-item" @click="editClinicalUnit(unit)" v-if="hasPermission('system', 'manage_departments')">
                                                            <i class="fas fa-edit"></i>
                                                            <span>Edit</span>
                                                        </div>
                                                        <div class="action-menu-item danger" @click="deleteClinicalUnit(unit.id)" v-if="hasPermission('system', 'manage_departments')">
                                                            <i class="fas fa-trash"></i>
                                                            <span>Delete</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Training Units View -->
                    <div v-if="currentView === 'training_units'">
                        <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <div>
                                <h2 class="section-title" style="font-size: 24px; font-weight: 600; color: var(--medical-dark-blue);">Training Units Management</h2>
                                <p class="text-muted" style="color: var(--medical-gray);">Manage clinical training units and resident assignments</p>
                            </div>
                            <div class="flex gap-2" style="display: flex; gap: 8px;">
                                <button class="btn btn-primary" @click="showAddTrainingUnitModal" v-if="hasPermission('training_units', 'create')">
                                    <i class="fas fa-plus"></i> Add Training Unit
                                </button>
                                <button class="btn btn-success" @click="showBulkAssignModal" v-if="hasPermission('training_units', 'update')">
                                    <i class="fas fa-users"></i> Bulk Assign
                                </button>
                            </div>
                        </div>

                        <!-- Training Units Grid -->
                        <div class="training-units-grid">
                            <div v-for="unit in trainingUnits" :key="unit.id" class="training-unit-card">
                                <div class="training-unit-header">
                                    <div>
                                        <div class="training-unit-title">{{ unit.name }}</div>
                                        <div class="training-unit-capacity">{{ unit.current_residents }}/{{ unit.max_capacity }} residents</div>
                                    </div>
                                    <span class="badge" :class="unit.status === 'active' ? 'status-available' : 'status-busy'">
                                        {{ unit.status }}
                                    </span>
                                </div>
                                
                                <div class="text-sm text-gray-600 mb-4">{{ unit.description || 'No description available' }}</div>
                                
                                <div class="training-unit-residents">
                                    <div class="text-sm font-medium mb-2">Assigned Residents:</div>
                                    <div v-if="getUnitResidents(unit.id).length === 0" class="text-sm text-gray-500 italic">
                                        No residents assigned
                                    </div>
                                    <div v-else>
                                        <div v-for="resident in getUnitResidents(unit.id)" :key="resident.id" class="resident-item">
                                            <div>
                                                <div class="resident-name">{{ resident.full_name }}</div>
                                                <div class="resident-level">{{ formatTrainingLevel(resident.training_level) }}</div>
                                            </div>
                                            <button class="btn btn-sm btn-outline-danger" @click="removeResidentFromUnit(resident.id, unit.id)" v-if="hasPermission('training_units', 'update')">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex gap-2 mt-4">
                                    <button class="btn btn-sm btn-primary flex-1" @click="editTrainingUnit(unit)" v-if="hasPermission('training_units', 'update')">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn btn-sm btn-secondary" @click="assignResidentToUnit(unit)" v-if="hasPermission('training_units', 'update')">
                                        <i class="fas fa-user-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Resident Rotations View -->
                    <div v-if="currentView === 'resident_rotations'">
                        <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <div>
                                <h2 class="section-title" style="font-size: 24px; font-weight: 600; color: var(--medical-dark-blue);">Resident Rotations</h2>
                                <p class="text-muted" style="color: var(--medical-gray);">Manage resident rotations and assignments</p>
                            </div>
                            <button class="btn btn-primary" @click="showAddRotationModal" v-if="hasPermission('resident_rotations', 'create')">
                                <i class="fas fa-plus"></i> Add Rotation
                            </button>
                        </div>

                        <!-- Filters -->
                        <div class="filter-bar" style="display: flex; gap: 12px; align-items: center; padding: 16px; background: white; border-radius: var(--border-radius-md); margin-bottom: 20px; flex-wrap: wrap; border: 1px solid var(--medical-light-blue);">
                            <div class="filter-group" style="display: flex; flex-direction: column; gap: 4px; min-width: 180px; flex: 1;">
                                <div class="filter-label" style="font-size: 12px; color: var(--medical-gray); font-weight: 500;">Resident</div>
                                <select class="form-select form-select-sm" v-model="rotationFilter.resident_id">
                                    <option value="">All Residents</option>
                                    <option v-for="resident in residents" :key="resident.id" :value="resident.id">
                                        {{ resident.full_name }}
                                    </option>
                                </select>
                            </div>
                            <div class="filter-group" style="display: flex; flex-direction: column; gap: 4px; min-width: 180px; flex: 1;">
                                <div class="filter-label" style="font-size: 12px; color: var(--medical-gray); font-weight: 500;">Status</div>
                                <select class="form-select form-select-sm" v-model="rotationFilter.status">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="upcoming">Upcoming</option>
                                    <option value="completed">Completed</option>
                                </select>
                            </div>
                            <div class="filter-actions" style="display: flex; gap: 8px; margin-left: auto;">
                                <button class="btn btn-sm btn-secondary" @click="resetRotationFilters">
                                    <i class="fas fa-redo"></i> Reset
                                </button>
                                <button class="btn btn-sm btn-primary" @click="applyRotationFilters">
                                    <i class="fas fa-filter"></i> Apply
                                </button>
                            </div>
                        </div>

                        <!-- Rotations Table -->
                        <div class="card">
                            <div v-if="loadingRotations" class="loading-overlay">
                                <div class="loading-spinner"></div>
                            </div>
                            <div v-else-if="filteredRotations.length === 0" class="empty-state">
                                <i class="fas fa-calendar-alt empty-state-icon"></i>
                                <div class="empty-state-title">No Rotations Found</div>
                                <div class="empty-state-description">
                                    Try adjusting your filters or add new rotations to get started.
                                </div>
                                <button class="btn btn-primary mt-4" @click="showAddRotationModal" v-if="hasPermission('resident_rotations', 'create')">
                                    <i class="fas fa-plus"></i> Add Rotation
                                </button>
                            </div>
                            <div v-else class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Resident</th>
                                            <th>Training Unit</th>
                                            <th>Start Date</th>
                                            <th>End Date</th>
                                            <th>Status</th>
                                            <th>Supervisor</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="rotation in filteredRotations" :key="rotation.id">
                                            <td>{{ getResidentName(rotation.resident_id) }}</td>
                                            <td>{{ getTrainingUnitName(rotation.training_unit_id) }}</td>
                                            <td>{{ formatDate(rotation.start_date) }}</td>
                                            <td>{{ formatDate(rotation.end_date) }}</td>
                                            <td>
                                                <span class="badge" :class="getRotationStatusClass(rotation.status)">
                                                    {{ formatRotationStatus(rotation.status) }}
                                                </span>
                                            </td>
                                            <td>{{ getSupervisorName(rotation.supervisor_id) || 'Not assigned' }}</td>
                                            <td>
                                                <div class="action-dropdown">
                                                    <button class="btn btn-sm btn-secondary" @click="toggleActionMenu($event)" aria-label="Rotation actions">
                                                        <i class="fas fa-ellipsis-v"></i>
                                                    </button>
                                                    <div class="action-menu">
                                                        <div class="action-menu-item" @click="viewRotationDetails(rotation)">
                                                            <i class="fas fa-eye"></i>
                                                            <span>View Details</span>
                                                        </div>
                                                        <div class="action-menu-item" @click="editRotation(rotation)" v-if="hasPermission('resident_rotations', 'update')">
                                                            <i class="fas fa-edit"></i>
                                                            <span>Edit</span>
                                                        </div>
                                                        <div class="action-menu-item danger" @click="deleteRotation(rotation.id)" v-if="hasPermission('resident_rotations', 'delete')">
                                                            <i class="fas fa-trash"></i>
                                                            <span>Delete</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Staff Absence View -->
                    <div v-if="currentView === 'staff_absence'">
                        <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <div>
                                <h2 class="section-title" style="font-size: 24px; font-weight: 600; color: var(--medical-dark-blue);">Staff Absence Management</h2>
                                <p class="text-muted" style="color: var(--medical-gray);">Track and manage staff absences and coverage</p>
                            </div>
                            <button class="btn btn-primary" @click="showAddAbsenceModal" v-if="hasPermission('staff_absence', 'create')">
                                <i class="fas fa-plus"></i> Document Absence
                            </button>
                        </div>

                        <!-- Filters -->
                        <div class="filter-bar" style="display: flex; gap: 12px; align-items: center; padding: 16px; background: white; border-radius: var(--border-radius-md); margin-bottom: 20px; flex-wrap: wrap; border: 1px solid var(--medical-light-blue);">
                            <div class="filter-group" style="display: flex; flex-direction: column; gap: 4px; min-width: 180px; flex: 1;">
                                <div class="filter-label" style="font-size: 12px; color: var(--medical-gray); font-weight: 500;">Staff Member</div>
                                <select class="form-select form-select-sm" v-model="absenceFilter.staff_id">
                                    <option value="">All Staff</option>
                                    <option v-for="staff in medicalStaff" :key="staff.id" :value="staff.id">
                                        {{ staff.full_name }}
                                    </option>
                                </select>
                            </div>
                            <div class="filter-group" style="display: flex; flex-direction: column; gap: 4px; min-width: 180px; flex: 1;">
                                <div class="filter-label" style="font-size: 12px; color: var(--medical-gray); font-weight: 500;">Status</div>
                                <select class="form-select form-select-sm" v-model="absenceFilter.status">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="upcoming">Upcoming</option>
                                    <option value="completed">Completed</option>
                                </select>
                            </div>
                            <div class="filter-group" style="display: flex; flex-direction: column; gap: 4px; min-width: 180px; flex: 1;">
                                <div class="filter-label" style="font-size: 12px; color: var(--medical-gray); font-weight: 500;">Date Range</div>
                                <input type="date" class="form-control form-control-sm" v-model="absenceFilter.start_date">
                            </div>
                            <div class="filter-actions" style="display: flex; gap: 8px; margin-left: auto;">
                                <button class="btn btn-sm btn-secondary" @click="resetAbsenceFilters">
                                    <i class="fas fa-redo"></i> Reset
                                </button>
                                <button class="btn btn-sm btn-primary" @click="applyAbsenceFilters">
                                    <i class="fas fa-filter"></i> Apply
                                </button>
                            </div>
                        </div>

                        <!-- Absence Calendar View -->
                        <div class="card mb-6">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-calendar"></i>
                                    Absence Calendar
                                </div>
                                <div class="flex gap-2">
                                    <button class="btn btn-sm btn-secondary" @click="showAbsenceCalendar('month')">Month</button>
                                    <button class="btn btn-sm btn-secondary" @click="showAbsenceCalendar('week')">Week</button>
                                    <button class="btn btn-sm btn-secondary" @click="showAbsenceCalendar('list')">List</button>
                                </div>
                            </div>
                            <div class="p-4">
                                <div v-if="loadingAbsences" class="loading-overlay">
                                    <div class="loading-spinner"></div>
                                </div>
                                <div v-else-if="filteredAbsences.length === 0" class="empty-state">
                                    <i class="fas fa-calendar-times empty-state-icon"></i>
                                    <div class="empty-state-title">No Absences Found</div>
                                    <div class="empty-state-description">
                                        No staff absences have been documented yet.
                                    </div>
                                </div>
                                <div v-else class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Staff Member</th>
                                                <th>Absence Reason</th>
                                                <th>Start Date</th>
                                                <th>End Date</th>
                                                <th>Duration</th>
                                                <th>Coverage</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="absence in filteredAbsences" :key="absence.id">
                                                <td>{{ getStaffName(absence.staff_member_id) }}</td>
                                                <td>{{ formatAbsenceReason(absence.absence_reason) }}</td>
                                                <td>{{ formatDate(absence.start_date) }}</td>
                                                <td>{{ formatDate(absence.end_date) }}</td>
                                                <td>{{ calculateAbsenceDuration(absence.start_date, absence.end_date) }} days</td>
                                                <td>{{ getStaffName(absence.replacement_staff_id) || 'No coverage' }}</td>
                                                <td>
                                                    <span class="badge" :class="getAbsenceStatusClass(absence.status)">
                                                        {{ formatAbsenceStatus(absence.status) }}
                                                    </span>
                                                </td>
                                                <td>
                                                    <div class="action-dropdown">
                                                        <button class="btn btn-sm btn-secondary" @click="toggleActionMenu($event)" aria-label="Absence actions">
                                                            <i class="fas fa-ellipsis-v"></i>
                                                        </button>
                                                        <div class="action-menu">
                                                            <div class="action-menu-item" @click="viewAbsenceDetails(absence)">
                                                                <i class="fas fa-eye"></i>
                                                                <span>View Details</span>
                                                            </div>
                                                            <div class="action-menu-item" @click="editAbsence(absence)" v-if="hasPermission('staff_absence', 'update')">
                                                                <i class="fas fa-edit"></i>
                                                                <span>Edit</span>
                                                            </div>
                                                            <div class="action-menu-item" @click="assignCoverage(absence)" v-if="hasPermission('staff_absence', 'update') && !absence.replacement_staff_id">
                                                                <i class="fas fa-user-md"></i>
                                                                <span>Assign Coverage</span>
                                                            </div>
                                                            <div class="action-menu-item danger" @click="deleteAbsence(absence.id)" v-if="hasPermission('staff_absence', 'delete')">
                                                                <i class="fas fa-trash"></i>
                                                                <span>Delete</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Communications View -->
                    <div v-if="currentView === 'communications'">
                        <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <div>
                                <h2 class="section-title" style="font-size: 24px; font-weight: 600; color: var(--medical-dark-blue);">Department Communications</h2>
                                <p class="text-muted" style="color: var(--medical-gray);">Announcements, capacity planning, and quick updates</p>
                            </div>
                            <button class="btn btn-primary" @click="showCommunicationsModal" 
                                    v-if="hasPermission('communications', 'create')">
                                <i class="fas fa-plus"></i> New Communication
                            </button>
                        </div>

                        <!-- Communications Feed -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6" style="display: grid; grid-template-columns: 1fr; gap: 24px;">
                            <div class="lg:col-span-2">
                                <div class="card mb-6">
                                    <div class="card-header">
                                        <div class="card-title">
                                            <i class="fas fa-bullhorn"></i>
                                            Recent Announcements
                                        </div>
                                    </div>
                                    <div class="activity-feed" style="background: white; border-radius: var(--border-radius-lg); padding: 24px;">
                                        <div v-for="announcement in recentAnnouncements" :key="announcement.id" style="display: flex; gap: 16px; padding: 16px 0; border-bottom: 1px solid var(--medical-light-blue);">
                                            <div :class="`bg-${getPriorityColor(announcement.priority_level)}`" style="width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; flex-shrink: 0;">
                                                <i class="fas fa-bullhorn"></i>
                                            </div>
                                            <div style="flex: 1;">
                                                <div style="font-weight: 600; margin-bottom: 4px;">{{ announcement.announcement_title }}</div>
                                                <div style="font-size: 14px; color: var(--gray-800); margin-bottom: 4px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">{{ announcement.announcement_content }}</div>
                                                <div style="font-size: 12px; color: var(--gray-500);">
                                                    {{ formatDateTime(announcement.publish_start_date) }}  
                                                    <span class="badge badge-sm" :class="`badge-${getPriorityColor(announcement.priority_level)}`">
                                                        {{ announcement.priority_level }}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <div class="card mb-6">
                                    <div class="card-header">
                                        <div class="card-title">
                                            <i class="fas fa-bed"></i>
                                            Today's Capacity
                                        </div>
                                        <span class="updated-timestamp" style="font-size: 11px; color: var(--medical-gray); display: flex; align-items: center; gap: 4px;">
                                            <i class="fas fa-sync"></i> Just now
                                        </span>
                                    </div>
                                    <div class="p-4">
                                        <div class="capacity-grid">
                                            <div class="capacity-card">
                                                <div class="capacity-card-header">
                                                    <div class="capacity-unit">Emergency Room</div>
                                                    <div class="capacity-status" :class="currentCapacity.er.status">
                                                        {{ currentCapacity.er.status }}
                                                    </div>
                                                </div>
                                                <div class="capacity-input-group">
                                                    <input type="number" class="capacity-input" v-model="currentCapacity.er.current" min="0" :max="currentCapacity.er.max" aria-label="ER current patients">
                                                    <span class="capacity-slash">/</span>
                                                    <input type="number" class="capacity-input" v-model="currentCapacity.er.max" min="1" aria-label="ER max capacity">
                                                </div>
                                            </div>
                                            
                                            <div class="capacity-card">
                                                <div class="capacity-card-header">
                                                    <div class="capacity-unit">Pulmo ICU</div>
                                                    <div class="capacity-status" :class="currentCapacity.icu.status">
                                                        {{ currentCapacity.icu.status }}
                                                    </div>
                                                </div>
                                                <div class="capacity-input-group">
                                                    <input type="number" class="capacity-input" v-model="currentCapacity.icu.current" min="0" :max="currentCapacity.icu.max" aria-label="ICU current patients">
                                                    <span class="capacity-slash">/</span>
                                                    <input type="number" class="capacity-input" v-model="currentCapacity.icu.max" min="1" aria-label="ICU max capacity">
                                                </div>
                                            </div>
                                        </div>
                                        <button class="btn btn-primary w-full mt-4" @click="updateCapacity" v-if="hasPermission('communications', 'update')">
                                            <i class="fas fa-save"></i> Update Capacity
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Audit Logs View -->
                    <div v-if="currentView === 'audit_logs'">
                        <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <div>
                                <h2 class="section-title" style="font-size: 24px; font-weight: 600; color: var(--medical-dark-blue);">Audit Logs</h2>
                                <p class="text-muted" style="color: var(--medical-gray);">System activity and user action tracking</p>
                            </div>
                            <button class="btn btn-primary" @click="exportAuditLogs" v-if="hasPermission('audit', 'export')">
                                <i class="fas fa-download"></i> Export Logs
                            </button>
                        </div>

                        <!-- Audit Filters -->
                        <div class="audit-filters">
                            <div class="filter-group" style="display: flex; flex-direction: column; gap: 4px; flex: 1;">
                                <div class="filter-label" style="font-size: 12px; color: var(--medical-gray); font-weight: 500;">Date Range</div>
                                <input type="date" class="form-control form-control-sm" v-model="auditFilters.dateRange">
                            </div>
                            <div class="filter-group" style="display: flex; flex-direction: column; gap: 4px; flex: 1;">
                                <div class="filter-label" style="font-size: 12px; color: var(--medical-gray); font-weight: 500;">Action Type</div>
                                <select class="form-select form-select-sm" v-model="auditFilters.actionType">
                                    <option value="">All Actions</option>
                                    <option value="create">Create</option>
                                    <option value="update">Update</option>
                                    <option value="delete">Delete</option>
                                    <option value="login">Login</option>
                                    <option value="logout">Logout</option>
                                </select>
                            </div>
                            <div class="filter-group" style="display: flex; flex-direction: column; gap: 4px; flex: 1;">
                                <div class="filter-label" style="font-size: 12px; color: var(--medical-gray); font-weight: 500;">User</div>
                                <select class="form-select form-select-sm" v-model="auditFilters.userId">
                                    <option value="">All Users</option>
                                    <option v-for="user in users" :key="user.id" :value="user.id">
                                        {{ user.full_name }}
                                    </option>
                                </select>
                            </div>
                            <div class="filter-actions" style="display: flex; gap: 8px; align-items: flex-end;">
                                <button class="btn btn-sm btn-secondary" @click="resetAuditFilters">
                                    <i class="fas fa-redo"></i> Reset
                                </button>
                                <button class="btn btn-sm btn-primary" @click="applyAuditFilters">
                                    <i class="fas fa-filter"></i> Apply
                                </button>
                            </div>
                        </div>

                        <!-- Audit Logs List -->
                        <div class="card">
                            <div v-if="loadingAuditLogs" class="loading-overlay">
                                <div class="loading-spinner"></div>
                            </div>
                            <div v-else-if="filteredAuditLogs.length === 0" class="empty-state">
                                <i class="fas fa-history empty-state-icon"></i>
                                <div class="empty-state-title">No Audit Logs Found</div>
                                <div class="empty-state-description">
                                    No audit logs match your filter criteria.
                                </div>
                            </div>
                            <div v-else>
                                <div v-for="log in filteredAuditLogs" :key="log.id" class="audit-log-item">
                                    <div class="audit-action">{{ formatAuditAction(log.action) }}</div>
                                    <div class="audit-details">
                                        <span>User: {{ getUserName(log.user_id) }}</span>
                                        <span>Module: {{ log.module }}</span>
                                        <span>IP: {{ log.ip_address }}</span>
                                    </div>
                                    <div class="audit-timestamp">
                                        <i class="fas fa-clock"></i> {{ formatDateTime(log.created_at) }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Permission Manager View -->
                    <div v-if="currentView === 'permission_manager'">
                        <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <div>
                                <h2 class="section-title" style="font-size: 24px; font-weight: 600; color: var(--medical-dark-blue);">Permission Manager</h2>
                                <p class="text-muted" style="color: var(--medical-gray);">Manage user permissions and access controls</p>
                            </div>
                            <button class="btn btn-primary" @click="showAddRoleModal" v-if="hasPermission('permissions', 'manage')">
                                <i class="fas fa-plus"></i> Add Role
                            </button>
                        </div>

                        <!-- Permission Grid -->
                        <div class="permission-grid">
                            <div v-for="role in userRoles" :key="role.id" class="permission-card">
                                <div class="permission-header">
                                    <div class="permission-role">{{ role.name }}</div>
                                    <div class="flex gap-2">
                                        <button class="btn btn-sm btn-primary" @click="editRole(role)" v-if="hasPermission('permissions', 'manage')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" @click="deleteRole(role.id)" v-if="hasPermission('permissions', 'manage') && role.name !== 'Administrator'">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="permission-checkboxes">
                                    <div v-for="permission in availablePermissions" :key="permission.id" class="form-check">
                                        <input type="checkbox" class="form-check-input" 
                                               :checked="roleHasPermission(role.id, permission.id)"
                                               @change="toggleRolePermission(role.id, permission.id)"
                                               :id="`role-${role.id}-permission-${permission.id}`">
                                        <label class="form-check-label" :for="`role-${role.id}-permission-${permission.id}`">
                                            {{ formatPermissionName(permission.name) }}
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- User Permissions Table -->
                        <div class="card mt-6">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-users"></i>
                                    User Permissions
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>User</th>
                                            <th>Role</th>
                                            <th>Permissions</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="user in users" :key="user.id">
                                            <td>{{ user.full_name }}</td>
                                            <td>{{ user.user_role }}</td>
                                            <td>
                                                <span class="badge badge-sm" v-for="permission in getUserPermissions(user.id)" :key="permission">
                                                    {{ permission }}
                                                </span>
                                            </td>
                                            <td>
                                                <button class="btn btn-sm btn-primary" @click="editUserPermissions(user)" v-if="hasPermission('permissions', 'manage')">
                                                    <i class="fas fa-edit"></i> Edit
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- System Settings View -->
                    <div v-if="currentView === 'system_settings'">
                        <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <div>
                                <h2 class="section-title" style="font-size: 24px; font-weight: 600; color: var(--medical-dark-blue);">System Settings</h2>
                                <p class="text-muted" style="color: var(--medical-gray);">Configure system preferences and behavior</p>
                            </div>
                            <button class="btn btn-primary" @click="saveSystemSettings">
                                <i class="fas fa-save"></i> Save Settings
                            </button>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <div class="modal-section">
                                    <div class="modal-section-title">
                                        <i class="fas fa-hospital"></i>
                                        Hospital Information
                                    </div>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div class="form-group">
                                            <label class="form-label">Hospital Name</label>
                                            <input type="text" class="form-control" v-model="systemSettings.hospital_name">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Default Department</label>
                                            <select class="form-select" v-model="systemSettings.default_department_id">
                                                <option value="">Select Default Department</option>
                                                <option v-for="department in departments" :key="department.id" :value="department.id">
                                                    {{ department.name }}
                                                </option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Max Residents per Training Unit</label>
                                            <input type="number" class="form-control" v-model="systemSettings.max_residents_per_unit" min="1" max="50">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Default Rotation Duration (weeks)</label>
                                            <input type="number" class="form-control" v-model="systemSettings.default_rotation_duration" min="1" max="52">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="modal-section">
                                    <div class="modal-section-title">
                                        <i class="fas fa-shield-alt"></i>
                                        Security Settings
                                    </div>
                                    <div class="form-group">
                                        <label class="form-check">
                                            <input type="checkbox" class="form-check-input" v-model="systemSettings.enable_audit_logging">
                                            <span class="form-check-label">Enable Audit Logging</span>
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-check">
                                            <input type="checkbox" class="form-check-input" v-model="systemSettings.require_mfa">
                                            <span class="form-check-label">Require MFA Authentication</span>
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-check">
                                            <input type="checkbox" class="form-check-input" v-model="systemSettings.maintenance_mode">
                                            <span class="form-check-label">Maintenance Mode</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="modal-section">
                                    <div class="modal-section-title">
                                        <i class="fas fa-bell"></i>
                                        Notification Settings
                                    </div>
                                    <div class="form-group">
                                        <label class="form-check">
                                            <input type="checkbox" class="form-check-input" v-model="systemSettings.notifications_enabled">
                                            <span class="form-check-label">Enable Email Notifications</span>
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-check">
                                            <input type="checkbox" class="form-check-input" v-model="systemSettings.absence_notifications">
                                            <span class="form-check-label">Staff Absence Notifications</span>
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-check">
                                            <input type="checkbox" class="form-check-input" v-model="systemSettings.announcement_notifications">
                                            <span class="form-check-label">Announcement Notifications</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- ============ MODALS ============ -->
        
        <!-- Staff Details Modal -->
        <div v-if="staffDetailsModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="staff-details-title">
            <div class="modal-container modal-xwide">
                <div class="modal-header">
                    <div class="modal-title" id="staff-details-title">
                        <i class="fas fa-user-md"></i>
                        Staff Profile
                    </div>
                    <button class="modal-close" @click="staffDetailsModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="staff-profile-header">
                        <div class="staff-avatar-large" aria-hidden="true">{{ getInitials(staffDetailsModal.staff.full_name) }}</div>
                        <div class="staff-basic-info">
                            <div class="staff-name">{{ staffDetailsModal.staff.full_name }}</div>
                            <div class="staff-title">{{ formatStaffType(staffDetailsModal.staff.staff_type) }}</div>
                            <span class="staff-status" :class="staffDetailsModal.staff.employment_status">
                                {{ formatEmploymentStatus(staffDetailsModal.staff.employment_status) }}
                            </span>
                        </div>
                    </div>

                    <div class="staff-stats">
                        <div class="staff-stat-card">
                            <div class="staff-stat-value">{{ staffDetailsModal.stats.completedRotations || 0 }}</div>
                            <div class="staff-stat-label">Completed Rotations</div>
                        </div>
                        <div class="staff-stat-card">
                            <div class="staff-stat-value">{{ staffDetailsModal.stats.oncallShifts || 0 }}</div>
                            <div class="staff-stat-label">On-call Shifts</div>
                        </div>
                        <div class="staff-stat-card">
                            <div class="staff-stat-value">{{ staffDetailsModal.stats.absenceDays || 0 }}</div>
                            <div class="staff-stat-label">Absence Days</div>
                        </div>
                        <div class="staff-stat-card">
                            <div class="staff-stat-value">{{ staffDetailsModal.stats.supervisionCount || 0 }}</div>
                            <div class="staff-stat-label">Residents Supervised</div>
                        </div>
                    </div>

                    <div class="modal-tabs" role="tablist">
                        <button class="modal-tab" :class="{ active: staffDetailsModal.activeTab === 'personal' }" 
                                @click="staffDetailsModal.activeTab = 'personal'" role="tab" aria-selected="staffDetailsModal.activeTab === 'personal'">
                            <i class="fas fa-user"></i> Personal Info
                        </button>
                        <button class="modal-tab" :class="{ active: staffDetailsModal.activeTab === 'professional' }" 
                                @click="staffDetailsModal.activeTab = 'professional'" role="tab" aria-selected="staffDetailsModal.activeTab === 'professional'">
                            <i class="fas fa-briefcase"></i> Professional Info
                        </button>
                        <button class="modal-tab" :class="{ active: staffDetailsModal.activeTab === 'contact' }" 
                                @click="staffDetailsModal.activeTab = 'contact'" role="tab" aria-selected="staffDetailsModal.activeTab === 'contact'">
                            <i class="fas fa-address-book"></i> Contact & Schedule
                        </button>
                        <button class="modal-tab" :class="{ active: staffDetailsModal.activeTab === 'history' }" 
                                @click="staffDetailsModal.activeTab = 'history'" role="tab" aria-selected="staffDetailsModal.activeTab === 'history'">
                            <i class="fas fa-history"></i> Activity History
                        </button>
                    </div>

                    <!-- Personal Info Tab -->
                    <div v-if="staffDetailsModal.activeTab === 'personal'" class="modal-tab-content active" role="tabpanel">
                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-id-card"></i>
                                Personal Information
                            </div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <div class="info-label">Date of Birth</div>
                                    <div class="info-value" :class="staffDetailsModal.staff.date_of_birth ? '' : 'unavailable'">
                                        {{ staffDetailsModal.staff.date_of_birth || 'Information unavailable' }}
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Medical License</div>
                                    <div class="info-value" :class="staffDetailsModal.staff.medical_license ? '' : 'unavailable'">
                                        {{ staffDetailsModal.staff.medical_license || 'Information unavailable' }}
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Years of Experience</div>
                                    <div class="info-value" :class="staffDetailsModal.staff.years_experience ? '' : 'unavailable'">
                                        {{ staffDetailsModal.staff.years_experience || 'Information unavailable' }}
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Biography</div>
                                    <div class="info-value" :class="staffDetailsModal.staff.biography ? '' : 'unavailable'">
                                        {{ staffDetailsModal.staff.biography || 'No biography available' }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Professional Info Tab -->
                    <div v-if="staffDetailsModal.activeTab === 'professional'" class="modal-tab-content active" role="tabpanel">
                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-graduation-cap"></i>
                                Professional Information
                            </div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <div class="info-label">Staff ID</div>
                                    <div class="info-value">{{ staffDetailsModal.staff.staff_id }}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Professional Email</div>
                                    <div class="info-value">{{ staffDetailsModal.staff.professional_email }}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Department</div>
                                    <div class="info-value" :class="staffDetailsModal.staff.department_id ? '' : 'unavailable'">
                                        {{ getDepartmentName(staffDetailsModal.staff.department_id) || 'Department information unavailable' }}
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Specialization</div>
                                    <div class="info-value" :class="staffDetailsModal.staff.specialization ? '' : 'unavailable'">
                                        {{ staffDetailsModal.staff.specialization || 'Specialization information unavailable' }}
                                    </div>
                                </div>
                                <div v-if="staffDetailsModal.staff.staff_type === 'medical_resident'" class="info-item">
                                    <div class="info-label">Resident Category</div>
                                    <div class="info-value" :class="staffDetailsModal.staff.resident_category ? '' : 'unavailable'">
                                        {{ staffDetailsModal.staff.resident_category ? formatResidentCategory(staffDetailsModal.staff.resident_category) : 'Resident category unavailable' }}
                                    </div>
                                </div>
                                <div v-if="staffDetailsModal.staff.staff_type === 'medical_resident'" class="info-item">
                                    <div class="info-label">Training Level</div>
                                    <div class="info-value" :class="staffDetailsModal.staff.training_level ? '' : 'unavailable'">
                                        {{ staffDetailsModal.staff.training_level ? formatTrainingLevel(staffDetailsModal.staff.training_level) : 'Training level unavailable' }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contact & Schedule Tab -->
                    <div v-if="staffDetailsModal.activeTab === 'contact'" class="modal-tab-content active" role="tabpanel">
                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-calendar-alt"></i>
                                Schedule Information
                            </div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <div class="info-label">Current Rotation</div>
                                    <div class="info-value" :class="staffDetailsModal.currentRotation ? '' : 'unavailable'">
                                        {{ staffDetailsModal.currentRotation || 'No active rotation' }}
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Next On-call</div>
                                    <div class="info-value" :class="staffDetailsModal.nextOncall ? '' : 'unavailable'">
                                        {{ staffDetailsModal.nextOncall || 'No upcoming on-call scheduled' }}
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Office Phone</div>
                                    <div class="info-value" :class="staffDetailsModal.staff.office_phone ? '' : 'unavailable'">
                                        {{ staffDetailsModal.staff.office_phone || 'Office phone unavailable' }}
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Mobile Phone</div>
                                    <div class="info-value" :class="staffDetailsModal.staff.mobile_phone ? '' : 'unavailable'">
                                        {{ staffDetailsModal.staff.mobile_phone || 'Mobile phone unavailable' }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Activity History Tab -->
                    <div v-if="staffDetailsModal.activeTab === 'history'" class="modal-tab-content active" role="tabpanel">
                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-history"></i>
                                Activity History
                            </div>
                            <div v-if="staffDetailsModal.activityHistory.length === 0" class="empty-state">
                                <i class="fas fa-history empty-state-icon"></i>
                                <div class="empty-state-title">No Activity History</div>
                                <div class="empty-state-description">
                                    No activity history found for this staff member.
                                </div>
                            </div>
                            <div v-else>
                                <div v-for="activity in staffDetailsModal.activityHistory" :key="activity.id" class="audit-log-item">
                                    <div class="audit-action">{{ formatAuditAction(activity.action) }}</div>
                                    <div class="audit-details">
                                        <span>Module: {{ activity.module }}</span>
                                        <span>Details: {{ activity.details }}</span>
                                    </div>
                                    <div class="audit-timestamp">
                                        <i class="fas fa-clock"></i> {{ formatDateTime(activity.created_at) }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="staffDetailsModal.show = false">Close</button>
                    <button class="btn btn-primary" @click="editMedicalStaff(staffDetailsModal.staff)"
                            v-if="hasPermission('medical_staff', 'update')">
                        <i class="fas fa-edit"></i> Edit Profile
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit Medical Staff Modal -->
        <div v-if="medicalStaffModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="medical-staff-title">
            <div class="modal-container modal-wide">
                <div class="modal-header">
                    <div class="modal-title" id="medical-staff-title">
                        <i class="fas fa-user-md"></i>
                        {{ medicalStaffModal.mode === 'add' ? 'Add Medical Staff' : 'Edit Medical Staff' }}
                    </div>
                    <button class="modal-close" @click="medicalStaffModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-tabs" role="tablist">
                        <button class="modal-tab" :class="{ active: medicalStaffModal.activeTab === 'basic' }" 
                                @click="medicalStaffModal.activeTab = 'basic'" role="tab" aria-selected="medicalStaffModal.activeTab === 'basic'">
                            <i class="fas fa-user"></i> Basic Information
                        </button>
                        <button class="modal-tab" :class="{ active: medicalStaffModal.activeTab === 'professional' }" 
                                @click="medicalStaffModal.activeTab = 'professional'" role="tab" aria-selected="medicalStaffModal.activeTab === 'professional'">
                            <i class="fas fa-graduation-cap"></i> Professional Details
                        </button>
                        <button class="modal-tab" :class="{ active: medicalStaffModal.activeTab === 'contact' }" 
                                @click="medicalStaffModal.activeTab = 'contact'" role="tab" aria-selected="medicalStaffModal.activeTab === 'contact'">
                            <i class="fas fa-address-book"></i> Contact Information
                        </button>
                    </div>

                    <!-- Basic Information Tab -->
                    <div v-if="medicalStaffModal.activeTab === 'basic'" class="modal-tab-content active" role="tabpanel">
                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-id-card"></i>
                                Basic Information
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">Full Name *</label>
                                    <input type="text" class="form-control" v-model="medicalStaffModal.form.full_name" aria-required="true">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Staff Type *</label>
                                    <select class="form-select" v-model="medicalStaffModal.form.staff_type" aria-required="true">
                                        <option value="medical_resident">Medical Resident</option>
                                        <option value="attending_physician">Attending Physician</option>
                                        <option value="fellow">Fellow</option>
                                        <option value="nurse_practitioner">Nurse Practitioner</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Staff ID</label>
                                    <input type="text" class="form-control" v-model="medicalStaffModal.form.staff_id">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Employment Status</label>
                                    <select class="form-select" v-model="medicalStaffModal.form.employment_status">
                                        <option value="active">Active</option>
                                        <option value="on_leave">On Leave</option>
                                        <option value="inactive">Inactive</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Professional Details Tab -->
                    <div v-if="medicalStaffModal.activeTab === 'professional'" class="modal-tab-content active" role="tabpanel">
                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-graduation-cap"></i>
                                Professional Details
                            </div>
                            
                            <div v-if="medicalStaffModal.form.staff_type === 'medical_resident'">
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="form-group">
                                        <label class="form-label">Resident Category</label>
                                        <select class="form-select" v-model="medicalStaffModal.form.resident_category">
                                            <option value="">Select Category</option>
                                            <option value="department_internal">Department Internal</option>
                                            <option value="rotating_other_dept">Rotating Other Dept</option>
                                            <option value="external_institution">External Institution</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Training Level</label>
                                        <select class="form-select" v-model="medicalStaffModal.form.training_level">
                                            <option value="">Select Level</option>
                                            <option value="pgy1">PGY-1</option>
                                            <option value="pgy2">PGY-2</option>
                                            <option value="pgy3">PGY-3</option>
                                            <option value="pgy4">PGY-4</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div v-if="medicalStaffModal.form.staff_type === 'attending_physician'">
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="form-group">
                                        <label class="form-label">Specialization</label>
                                        <input type="text" class="form-control" v-model="medicalStaffModal.form.specialization">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Years of Experience</label>
                                        <input type="number" class="form-control" v-model="medicalStaffModal.form.years_experience" min="0" max="50">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Biography</label>
                                <textarea class="form-control" v-model="medicalStaffModal.form.biography" rows="4"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information Tab -->
                    <div v-if="medicalStaffModal.activeTab === 'contact'" class="modal-tab-content active" role="tabpanel">
                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-envelope"></i>
                                Contact Information
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">Professional Email *</label>
                                    <input type="email" class="form-control" v-model="medicalStaffModal.form.professional_email" aria-required="true">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Department</label>
                                    <select class="form-select" v-model="medicalStaffModal.form.department_id">
                                        <option value="">Select Department</option>
                                        <option v-for="department in departments" :key="department.id" :value="department.id">
                                            {{ department.name }}
                                        </option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Office Phone</label>
                                    <input type="tel" class="form-control" v-model="medicalStaffModal.form.office_phone">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Mobile Phone</label>
                                    <input type="tel" class="form-control" v-model="medicalStaffModal.form.mobile_phone">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Medical License Number</label>
                                    <input type="text" class="form-control" v-model="medicalStaffModal.form.medical_license">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Date of Birth</label>
                                    <input type="date" class="form-control" v-model="medicalStaffModal.form.date_of_birth">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="medicalStaffModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveMedicalStaff" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>{{ medicalStaffModal.mode === 'add' ? 'Add Staff' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit Department Modal -->
        <div v-if="departmentModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="department-title">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title" id="department-title">
                        <i class="fas fa-hospital"></i>
                        {{ departmentModal.mode === 'add' ? 'Add Department' : 'Edit Department' }}
                    </div>
                    <button class="modal-close" @click="departmentModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-info-circle"></i>
                            Department Information
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Department Name *</label>
                                <input type="text" class="form-control" v-model="departmentModal.form.name" aria-required="true">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Department Code *</label>
                                <input type="text" class="form-control" v-model="departmentModal.form.code" aria-required="true">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-select" v-model="departmentModal.form.status">
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="archived">Archived</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Head of Department</label>
                                <select class="form-select" v-model="departmentModal.form.head_of_department_id">
                                    <option value="">Select Head</option>
                                    <option v-for="staff in availableHeadsOfDepartment" :key="staff.id" :value="staff.id">
                                        {{ staff.full_name }}
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" v-model="departmentModal.form.description" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="departmentModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveDepartment" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>{{ departmentModal.mode === 'add' ? 'Add Department' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit Clinical Unit Modal -->
        <div v-if="clinicalUnitModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="clinical-unit-title">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title" id="clinical-unit-title">
                        <i class="fas fa-clinic-medical"></i>
                        {{ clinicalUnitModal.mode === 'add' ? 'Add Clinical Unit' : 'Edit Clinical Unit' }}
                    </div>
                    <button class="modal-close" @click="clinicalUnitModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-info-circle"></i>
                            Clinical Unit Information
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Unit Name *</label>
                                <input type="text" class="form-control" v-model="clinicalUnitModal.form.name" aria-required="true">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Unit Code *</label>
                                <input type="text" class="form-control" v-model="clinicalUnitModal.form.code" aria-required="true">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Department *</label>
                                <select class="form-select" v-model="clinicalUnitModal.form.department_id" aria-required="true">
                                    <option value="">Select Department</option>
                                    <option v-for="department in departments" :key="department.id" :value="department.id">
                                        {{ department.name }}
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Unit Type</label>
                                <select class="form-select" v-model="clinicalUnitModal.form.unit_type">
                                    <option value="clinical">Clinical</option>
                                    <option value="administrative">Administrative</option>
                                    <option value="support">Support</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-select" v-model="clinicalUnitModal.form.status">
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="maintenance">Maintenance</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Supervisor</label>
                                <select class="form-select" v-model="clinicalUnitModal.form.supervisor_id">
                                    <option value="">Select Supervisor</option>
                                    <option v-for="staff in availableSupervisors" :key="staff.id" :value="staff.id">
                                        {{ staff.full_name }}
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" v-model="clinicalUnitModal.form.description" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="clinicalUnitModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveClinicalUnit" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>{{ clinicalUnitModal.mode === 'add' ? 'Add Clinical Unit' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit Training Unit Modal -->
        <div v-if="trainingUnitModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="training-unit-title">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title" id="training-unit-title">
                        <i class="fas fa-clinic-medical"></i>
                        {{ trainingUnitModal.mode === 'add' ? 'Add Training Unit' : 'Edit Training Unit' }}
                    </div>
                    <button class="modal-close" @click="trainingUnitModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-info-circle"></i>
                            Training Unit Information
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Unit Name *</label>
                                <input type="text" class="form-control" v-model="trainingUnitModal.form.name" aria-required="true">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Department *</label>
                                <select class="form-select" v-model="trainingUnitModal.form.department_id" aria-required="true">
                                    <option value="">Select Department</option>
                                    <option v-for="department in departments" :key="department.id" :value="department.id">
                                        {{ department.name }}
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Supervisor</label>
                                <select class="form-select" v-model="trainingUnitModal.form.supervisor_id">
                                    <option value="">Select Supervisor</option>
                                    <option v-for="staff in availableAttendings" :key="staff.id" :value="staff.id">
                                        {{ staff.full_name }}
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Max Capacity</label>
                                <input type="number" class="form-control" v-model="trainingUnitModal.form.max_capacity" min="1" max="50">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-select" v-model="trainingUnitModal.form.status">
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="maintenance">Maintenance</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" v-model="trainingUnitModal.form.description" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="trainingUnitModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveTrainingUnit" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>{{ trainingUnitModal.mode === 'add' ? 'Add Training Unit' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit Rotation Modal -->
        <div v-if="rotationModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="rotation-title">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title" id="rotation-title">
                        <i class="fas fa-calendar-alt"></i>
                        {{ rotationModal.mode === 'add' ? 'Add Rotation' : 'Edit Rotation' }}
                    </div>
                    <button class="modal-close" @click="rotationModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-user-graduate"></i>
                            Rotation Details
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Resident *</label>
                                <select class="form-select" v-model="rotationModal.form.resident_id" aria-required="true">
                                    <option value="">Select Resident</option>
                                    <option v-for="resident in availableResidents" :key="resident.id" :value="resident.id">
                                        {{ resident.full_name }} ({{ formatTrainingLevel(resident.training_level) }})
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Training Unit *</label>
                                <select class="form-select" v-model="rotationModal.form.training_unit_id" aria-required="true">
                                    <option value="">Select Unit</option>
                                    <option v-for="unit in availableTrainingUnits" :key="unit.id" :value="unit.id">
                                        {{ unit.name }} ({{ unit.current_residents }}/{{ unit.max_capacity }})
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Start Date *</label>
                                <input type="date" class="form-control" v-model="rotationModal.form.start_date" aria-required="true">
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Date *</label>
                                <input type="date" class="form-control" v-model="rotationModal.form.end_date" aria-required="true">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Supervisor</label>
                                <select class="form-select" v-model="rotationModal.form.supervisor_id">
                                    <option value="">Select Supervisor</option>
                                    <option v-for="supervisor in availableSupervisors" :key="supervisor.id" :value="supervisor.id">
                                        {{ supervisor.full_name }}
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-select" v-model="rotationModal.form.status">
                                    <option value="active">Active</option>
                                    <option value="upcoming">Upcoming</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Rotation Goals</label>
                            <textarea class="form-control" v-model="rotationModal.form.goals" rows="3"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" v-model="rotationModal.form.notes" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="rotationModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveRotation" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>{{ rotationModal.mode === 'add' ? 'Add Rotation' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit On-call Schedule Modal -->
        <div v-if="onCallModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="oncall-title">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title" id="oncall-title">
                        <i class="fas fa-phone-alt"></i>
                        {{ onCallModal.mode === 'add' ? 'Add On-call Schedule' : 'Edit On-call Schedule' }}
                    </div>
                    <button class="modal-close" @click="onCallModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-calendar"></i>
                            Schedule Details
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Duty Date *</label>
                                <input type="date" class="form-control" v-model="onCallModal.form.duty_date" aria-required="true">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Shift Type</label>
                                <select class="form-select" v-model="onCallModal.form.shift_type">
                                    <option value="backup_call">Backup Call</option>
                                    <option value="primary_call">Primary Call</option>
                                    <option value="emergency_call">Emergency Call</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Start Time</label>
                                <input type="time" class="form-control" v-model="onCallModal.form.start_time">
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Time</label>
                                <input type="time" class="form-control" v-model="onCallModal.form.end_time">
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-user-md"></i>
                            Physician Assignment
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Primary Physician *</label>
                                <select class="form-select" v-model="onCallModal.form.primary_physician_id" aria-required="true">
                                    <option value="">Select Physician</option>
                                    <option v-for="physician in availablePhysicians" :key="physician.id" :value="physician.id">
                                        {{ physician.full_name }} ({{ formatStaffType(physician.staff_type) }})
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Backup Physician</label>
                                <select class="form-select" v-model="onCallModal.form.backup_physician_id">
                                    <option value="">Select Backup Physician</option>
                                    <option v-for="physician in availablePhysicians" :key="physician.id" :value="physician.id">
                                        {{ physician.full_name }} ({{ formatStaffType(physician.staff_type) }})
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-sticky-note"></i>
                            Additional Information
                        </div>
                        <div class="form-group">
                            <label class="form-label">Coverage Notes</label>
                            <textarea class="form-control" v-model="onCallModal.form.coverage_notes" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="onCallModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveOnCallSchedule" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>{{ onCallModal.mode === 'add' ? 'Add Schedule' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit Staff Absence Modal -->
        <div v-if="absenceModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="absence-title">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title" id="absence-title">
                        <i class="fas fa-calendar-times"></i>
                        {{ absenceModal.mode === 'add' ? 'Document Staff Absence' : 'Edit Absence Record' }}
                    </div>
                    <button class="modal-close" @click="absenceModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-calendar-alt"></i>
                            Absence Details
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Staff Member *</label>
                                <select class="form-select" v-model="absenceModal.form.staff_member_id" aria-required="true">
                                    <option value="">Select Staff Member</option>
                                    <option v-for="staff in availableStaff" :key="staff.id" :value="staff.id">
                                        {{ staff.full_name }} ({{ formatStaffType(staff.staff_type) }})
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Absence Reason *</label>
                                <select class="form-select" v-model="absenceModal.form.absence_reason" aria-required="true">
                                    <option value="">Select Reason</option>
                                    <option value="vacation">Vacation</option>
                                    <option value="sick_leave">Sick Leave</option>
                                    <option value="conference">Conference/Education</option>
                                    <option value="personal">Personal</option>
                                    <option value="maternity_paternity">Maternity/Paternity</option>
                                    <option value="administrative">Administrative Duty</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Start Date *</label>
                                <input type="date" class="form-control" v-model="absenceModal.form.start_date" aria-required="true">
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Date *</label>
                                <input type="date" class="form-control" v-model="absenceModal.form.end_date" aria-required="true">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Additional Notes</label>
                            <textarea class="form-control" v-model="absenceModal.form.notes" rows="3"></textarea>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-user-md"></i>
                            Coverage Arrangement
                        </div>
                        <div class="form-group">
                            <label class="form-label">Replacement Staff</label>
                            <select class="form-select" v-model="absenceModal.form.replacement_staff_id">
                                <option value="">No Replacement (Coverage Managed Elsewhere)</option>
                                <option v-for="staff in availableCoverageStaff" :key="staff.id" :value="staff.id">
                                    {{ staff.full_name }} ({{ formatStaffType(staff.staff_type) }})
                                </option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Coverage Instructions</label>
                            <textarea class="form-control" v-model="absenceModal.form.coverage_instructions" rows="3" 
                                      placeholder="Any specific instructions for covering clinical duties..."></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="absenceModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveAbsence" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>{{ absenceModal.mode === 'add' ? 'Document Absence' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Quick Placement Modal -->
        <div v-if="quickPlacementModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="quick-placement-title">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title" id="quick-placement-title">
                        <i class="fas fa-user-md"></i>
                        Quick Resident Placement
                    </div>
                    <button class="modal-close" @click="quickPlacementModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-user-graduate"></i>
                            Select Resident
                        </div>
                        <div class="form-group">
                            <label class="form-label">Resident *</label>
                            <select class="form-select" v-model="quickPlacementModal.resident_id" aria-required="true">
                                <option value="">Select Resident</option>
                                <option v-for="resident in availableResidents" :key="resident.id" :value="resident.id">
                                    {{ resident.full_name }} ({{ resident.training_level }})
                                </option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-clinic-medical"></i>
                            Placement Details
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Training Unit *</label>
                                <select class="form-select" v-model="quickPlacementModal.training_unit_id" aria-required="true">
                                    <option value="">Select Unit</option>
                                    <option v-for="unit in availableTrainingUnits" :key="unit.id" :value="unit.id">
                                        {{ unit.name }} ({{ unit.current_residents }}/{{ unit.max_capacity }})
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Start Date *</label>
                                <input type="date" class="form-control" v-model="quickPlacementModal.start_date" aria-required="true">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Duration (weeks)</label>
                                <input type="number" class="form-control" v-model="quickPlacementModal.duration" min="1" max="52" value="4">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Supervisor</label>
                                <select class="form-select" v-model="quickPlacementModal.supervisor_id">
                                    <option value="">Select Supervisor</option>
                                    <option v-for="supervisor in availableSupervisors" :key="supervisor.id" :value="supervisor.id">
                                        {{ supervisor.full_name }}
                                    </option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" v-model="quickPlacementModal.notes" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="quickPlacementModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveQuickPlacement" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else><i class="fas fa-check"></i> Place Resident</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Bulk Assign Modal -->
        <div v-if="bulkAssignModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="bulk-assign-title">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title" id="bulk-assign-title">
                        <i class="fas fa-users"></i>
                        Bulk Resident Assignment
                    </div>
                    <button class="modal-close" @click="bulkAssignModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-user-graduate"></i>
                            Select Residents
                        </div>
                        <div class="form-group">
                            <label class="form-label">Available Residents</label>
                            <select class="form-select" v-model="bulkAssignModal.selectedResidents" multiple style="height: 200px;">
                                <option v-for="resident in availableResidents" :key="resident.id" :value="resident.id">
                                    {{ resident.full_name }} ({{ resident.training_level }})
                                </option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-clinic-medical"></i>
                            Assignment Details
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Training Unit *</label>
                                <select class="form-select" v-model="bulkAssignModal.training_unit_id" aria-required="true">
                                    <option value="">Select Unit</option>
                                    <option v-for="unit in availableTrainingUnits" :key="unit.id" :value="unit.id">
                                        {{ unit.name }} ({{ unit.current_residents }}/{{ unit.max_capacity }})
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Start Date *</label>
                                <input type="date" class="form-control" v-model="bulkAssignModal.start_date" aria-required="true">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Duration (weeks)</label>
                                <input type="number" class="form-control" v-model="bulkAssignModal.duration" min="1" max="52" value="4">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Supervisor</label>
                                <select class="form-select" v-model="bulkAssignModal.supervisor_id">
                                    <option value="">Select Supervisor</option>
                                    <option v-for="supervisor in availableSupervisors" :key="supervisor.id" :value="supervisor.id">
                                        {{ supervisor.full_name }}
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="bulkAssignModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveBulkAssignment" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else><i class="fas fa-users"></i> Assign Residents</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Communications Modal -->
        <div v-if="communicationsModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="communications-title">
            <div class="modal-container modal-wide">
                <div class="modal-header">
                    <div class="modal-title" id="communications-title">
                        <i class="fas fa-comments"></i>
                        Department Communications
                    </div>
                    <button class="modal-close" @click="communicationsModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-tabs" role="tablist">
                        <button class="modal-tab" :class="{ active: communicationsModal.activeTab === 'announcement' }" 
                                @click="communicationsModal.activeTab = 'announcement'" role="tab" aria-selected="communicationsModal.activeTab === 'announcement'">
                            <i class="fas fa-bullhorn"></i> Announcement
                        </button>
                        <button class="modal-tab" :class="{ active: communicationsModal.activeTab === 'capacity' }" 
                                @click="communicationsModal.activeTab = 'capacity'" role="tab" aria-selected="communicationsModal.activeTab === 'capacity'">
                            <i class="fas fa-bed"></i> Capacity Planning
                        </button>
                        <button class="modal-tab" :class="{ active: communicationsModal.activeTab === 'quick' }" 
                                @click="communicationsModal.activeTab = 'quick'" role="tab" aria-selected="communicationsModal.activeTab === 'quick'">
                            <i class="fas fa-comment-medical"></i> Quick Update
                        </button>
                    </div>

                    <!-- Announcement Tab -->
                    <div v-if="communicationsModal.activeTab === 'announcement'" class="modal-tab-content active" role="tabpanel">
                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-edit"></i>
                                Announcement Details
                            </div>
                            <div class="form-group">
                                <label class="form-label">Title *</label>
                                <input type="text" class="form-control" v-model="communicationsModal.form.announcement_title" aria-required="true">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Content *</label>
                                <textarea class="form-control" v-model="communicationsModal.form.announcement_content" rows="6" aria-required="true"></textarea>
                            </div>
                        </div>
                        
                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-cog"></i>
                                Settings
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">Publish Date *</label>
                                    <input type="date" class="form-control" v-model="communicationsModal.form.publish_start_date" aria-required="true">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Expiry Date</label>
                                    <input type="date" class="form-control" v-model="communicationsModal.form.publish_end_date">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Priority Level</label>
                                    <select class="form-select" v-model="communicationsModal.form.priority_level">
                                        <option value="low">Low</option>
                                        <option value="medium">Medium</option>
                                        <option value="high">High</option>
                                        <option value="urgent">Urgent</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Target Audience</label>
                                    <select class="form-select" v-model="communicationsModal.form.target_audience">
                                        <option value="all">All Staff</option>
                                        <option value="residents">Residents Only</option>
                                        <option value="attendings">Attending Physicians</option>
                                        <option value="nursing">Nursing Staff</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Capacity Planning Tab -->
                    <div v-if="communicationsModal.activeTab === 'capacity'" class="modal-tab-content active" role="tabpanel">
                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-hospital"></i>
                                Daily Capacity Planning
                            </div>
                            <p class="text-sm text-gray-600 mb-4">Set expected patient numbers for today</p>
                            
                            <div class="capacity-grid">
                                <div class="capacity-card">
                                    <div class="capacity-card-header">
                                        <div class="capacity-unit">Emergency Room</div>
                                        <div class="capacity-status" :class="getCapacityStatus(communicationsModal.capacity.er)">
                                            {{ getCapacityStatus(communicationsModal.capacity.er) }}
                                        </div>
                                    </div>
                                    <div class="capacity-input-group">
                                        <input type="number" class="capacity-input" v-model="communicationsModal.capacity.er.current" 
                                               placeholder="Current" min="0" :max="communicationsModal.capacity.er.max" aria-label="ER current patients">
                                        <span class="capacity-slash">/</span>
                                        <input type="number" class="capacity-input" v-model="communicationsModal.capacity.er.max" 
                                               placeholder="Capacity" min="1" aria-label="ER max capacity">
                                    </div>
                                    <div class="mt-2">
                                        <input type="text" class="form-control form-control-sm" 
                                               v-model="communicationsModal.capacity.er.notes" placeholder="Notes (e.g., 'High flu season')">
                                    </div>
                                </div>
                                
                                <div class="capacity-card">
                                    <div class="capacity-card-header">
                                        <div class="capacity-unit">Pulmo ICU</div>
                                        <div class="capacity-status" :class="getCapacityStatus(communicationsModal.capacity.icu)">
                                            {{ getCapacityStatus(communicationsModal.capacity.icu) }}
                                        </div>
                                    </div>
                                    <div class="capacity-input-group">
                                        <input type="number" class="capacity-input" v-model="communicationsModal.capacity.icu.current" 
                                               placeholder="Current" min="0" :max="communicationsModal.capacity.icu.max" aria-label="ICU current patients">
                                        <span class="capacity-slash">/</span>
                                        <input type="number" class="capacity-input" v-model="communicationsModal.capacity.icu.max" 
                                               placeholder="Capacity" min="1" aria-label="ICU max capacity">
                                    </div>
                                    <div class="mt-2">
                                        <input type="text" class="form-control form-control-sm" 
                                               v-model="communicationsModal.capacity.icu.notes" placeholder="Notes">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group mt-4">
                                <label class="form-label">Overall Notes & Alerts</label>
                                <textarea class="form-control" v-model="communicationsModal.capacity.overall_notes" rows="3" 
                                          placeholder="Add any additional notes or alerts for the department..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Update Tab -->
                    <div v-if="communicationsModal.activeTab === 'quick'" class="modal-tab-content active" role="tabpanel">
                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-comment-medical"></i>
                                Quick Status Update
                            </div>
                            <div class="form-group">
                                <label class="form-label">Message *</label>
                                <textarea class="form-control" v-model="communicationsModal.quickUpdate.message" rows="4" 
                                          placeholder="What's the latest update? (e.g., 'CT scanner maintenance until 2 PM', 'New guideline for asthma management available')" aria-required="true"></textarea>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">Priority</label>
                                    <select class="form-select" v-model="communicationsModal.quickUpdate.priority">
                                        <option value="info">Information</option>
                                        <option value="warning">Warning</option>
                                        <option value="alert">Alert</option>
                                        <option value="update">Update</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Expires In</label>
                                    <select class="form-select" v-model="communicationsModal.quickUpdate.expires">
                                        <option value="1">1 hour</option>
                                        <option value="4">4 hours</option>
                                        <option value="8">8 hours</option>
                                        <option value="24">24 hours</option>
                                        <option value="168">1 week</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tags (comma separated)</label>
                                <input type="text" class="form-control" v-model="communicationsModal.quickUpdate.tags" 
                                       placeholder="equipment, guidelines, staffing, maintenance">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="communicationsModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveCommunication" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>
                            <i class="fas" :class="getCommunicationIcon(communicationsModal.activeTab)"></i>
                            {{ getCommunicationButtonText(communicationsModal.activeTab) }}
                        </span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Permission Role Modal -->
        <div v-if="roleModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="role-title">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title" id="role-title">
                        <i class="fas fa-user-shield"></i>
                        {{ roleModal.mode === 'add' ? 'Add Role' : 'Edit Role' }}
                    </div>
                    <button class="modal-close" @click="roleModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-info-circle"></i>
                            Role Information
                        </div>
                        <div class="form-group">
                            <label class="form-label">Role Name *</label>
                            <input type="text" class="form-control" v-model="roleModal.form.name" aria-required="true">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" v-model="roleModal.form.description" rows="3"></textarea>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-shield-alt"></i>
                            Permissions
                        </div>
                        <div class="permission-checkboxes">
                            <div v-for="permission in availablePermissions" :key="permission.id" class="form-check">
                                <input type="checkbox" class="form-check-input" 
                                       v-model="roleModal.form.permissions"
                                       :value="permission.id"
                                       :id="`permission-${permission.id}`">
                                <label class="form-check-label" :for="`permission-${permission.id}`">
                                    {{ formatPermissionName(permission.name) }}
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="roleModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveRole" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>{{ roleModal.mode === 'add' ? 'Add Role' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- User Profile Modal -->
        <div v-if="userProfileModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="user-profile-title">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title" id="user-profile-title">
                        <i class="fas fa-user"></i> Profile Settings
                    </div>
                    <button class="modal-close" @click="userProfileModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-id-card"></i>
                            Personal Information
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-control" v-model="userProfileModal.form.full_name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email Address</label>
                                <input type="email" class="form-control" v-model="userProfileModal.form.email" disabled>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Phone Number</label>
                                <input type="text" class="form-control" v-model="userProfileModal.form.phone">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Department</label>
                                <select class="form-select" v-model="userProfileModal.form.department_id">
                                    <option value="">Select Department</option>
                                    <option v-for="department in departments" :key="department.id" :value="department.id">
                                        {{ department.name }}
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-bell"></i>
                            Notification Preferences
                        </div>
                        <div class="form-group">
                            <label class="form-check">
                                <input type="checkbox" class="form-check-input" v-model="userProfileModal.form.notifications_enabled">
                                <span class="form-check-label">Enable Email Notifications</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="form-check">
                                <input type="checkbox" class="form-check-input" v-model="userProfileModal.form.absence_notifications">
                                <span class="form-check-label">Staff Absence Notifications</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="form-check">
                                <input type="checkbox" class="form-check-input" v-model="userProfileModal.form.announcement_notifications">
                                <span class="form-check-label">Announcement Notifications</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="userProfileModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveUserProfile" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>Save Profile</span>
                    </button>
                </div>
            </div>
        </div>
                <!-- Absence Details Modal -->
        <div v-if="absenceDetailsModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="absence-details-title">
            <div class="modal-container modal-wide">
                <div class="modal-header">
                    <div class="modal-title" id="absence-details-title">
                        <i class="fas fa-calendar-times"></i>
                        Absence Record Details
                    </div>
                    <button class="modal-close" @click="absenceDetailsModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="staff-profile-header">
                        <div class="staff-avatar-large" aria-hidden="true">{{ getInitials(getStaffName(absenceDetailsModal.absence.staff_member_id)) }}</div>
                        <div class="staff-basic-info">
                            <div class="staff-name">{{ getStaffName(absenceDetailsModal.absence.staff_member_id) }}</div>
                            <div class="staff-title">{{ formatAbsenceReason(absenceDetailsModal.absence.absence_reason) }}</div>
                            <span class="staff-status" :class="getAbsenceStatusClass(absenceDetailsModal.absence.status)">
                                {{ formatAbsenceStatus(absenceDetailsModal.absence.status) }}
                            </span>
                        </div>
                    </div>

                    <div class="staff-stats">
                        <div class="staff-stat-card">
                            <div class="staff-stat-value">{{ calculateAbsenceDuration(absenceDetailsModal.absence.start_date, absenceDetailsModal.absence.end_date) }}</div>
                            <div class="staff-stat-label">Total Days</div>
                        </div>
                        <div class="staff-stat-card">
                            <div class="staff-stat-value">{{ formatDate(absenceDetailsModal.absence.start_date) }}</div>
                            <div class="staff-stat-label">Start Date</div>
                        </div>
                        <div class="staff-stat-card">
                            <div class="staff-stat-value">{{ formatDate(absenceDetailsModal.absence.end_date) }}</div>
                            <div class="staff-stat-label">End Date</div>
                        </div>
                        <div class="staff-stat-card">
                            <div class="staff-stat-value">{{ absenceDetailsModal.absence.replacement_staff_id ? getStaffName(absenceDetailsModal.absence.replacement_staff_id) : 'No coverage' }}</div>
                            <div class="staff-stat-label">Coverage Assigned</div>
                        </div>
                    </div>

                    <div class="modal-tabs" role="tablist">
                        <button class="modal-tab" :class="{ active: absenceDetailsModal.activeTab === 'details' }" 
                                @click="absenceDetailsModal.activeTab = 'details'" role="tab" aria-selected="absenceDetailsModal.activeTab === 'details'">
                            <i class="fas fa-info-circle"></i> Absence Details
                        </button>
                        <button class="modal-tab" :class="{ active: absenceDetailsModal.activeTab === 'coverage' }" 
                                @click="absenceDetailsModal.activeTab = 'coverage'" role="tab" aria-selected="absenceDetailsModal.activeTab === 'coverage'">
                            <i class="fas fa-user-md"></i> Coverage Information
                        </button>
                        <button class="modal-tab" :class="{ active: absenceDetailsModal.activeTab === 'timeline' }" 
                                @click="absenceDetailsModal.activeTab = 'timeline'" role="tab" aria-selected="absenceDetailsModal.activeTab === 'timeline'">
                            <i class="fas fa-history"></i> Status Timeline
                        </button>
                    </div>

                    <!-- Details Tab -->
                    <div v-if="absenceDetailsModal.activeTab === 'details'" class="modal-tab-content active" role="tabpanel">
                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-file-medical"></i>
                                Absence Information
                            </div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <div class="info-label">Documented By</div>
                                    <div class="info-value">{{ absenceDetailsModal.absence.documented_by || 'System Administrator' }}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Documentation Date</div>
                                    <div class="info-value">{{ formatDateTime(absenceDetailsModal.absence.created_at) }}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Approval Status</div>
                                    <div class="info-value">
                                        <span class="badge" :class="getApprovalStatusClass(absenceDetailsModal.absence.approval_status)">
                                            {{ formatApprovalStatus(absenceDetailsModal.absence.approval_status) }}
                                        </span>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Last Updated</div>
                                    <div class="info-value">{{ formatTimeAgo(absenceDetailsModal.absence.updated_at) }}</div>
                                </div>
                            </div>
                        </div>

                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-sticky-note"></i>
                                Notes & Documentation
                            </div>
                            <div class="info-item">
                                <div class="info-label">Additional Notes</div>
                                <div class="info-value" :class="absenceDetailsModal.absence.notes ? '' : 'unavailable'">
                                    {{ absenceDetailsModal.absence.notes || 'No additional notes provided' }}
                                </div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Supporting Documentation</div>
                                <div class="info-value" :class="absenceDetailsModal.absence.supporting_docs ? '' : 'unavailable'">
                                    {{ absenceDetailsModal.absence.supporting_docs || 'No supporting documentation attached' }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Coverage Tab -->
                    <div v-if="absenceDetailsModal.activeTab === 'coverage'" class="modal-tab-content active" role="tabpanel">
                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-user-shield"></i>
                                Coverage Arrangement
                            </div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <div class="info-label">Coverage Type</div>
                                    <div class="info-value">{{ absenceDetailsModal.absence.coverage_type || 'Standard coverage' }}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Coverage Assigned</div>
                                    <div class="info-value" :class="absenceDetailsModal.absence.replacement_staff_id ? '' : 'unavailable'">
                                        {{ absenceDetailsModal.absence.replacement_staff_id ? getStaffName(absenceDetailsModal.absence.replacement_staff_id) : 'Coverage not yet assigned' }}
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Coverage Contact</div>
                                    <div class="info-value" :class="absenceDetailsModal.absence.coverage_contact ? '' : 'unavailable'">
                                        {{ absenceDetailsModal.absence.coverage_contact || 'Contact information not available' }}
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Coverage Start Date</div>
                                    <div class="info-value">{{ formatDate(absenceDetailsModal.absence.coverage_start_date) || 'Not specified' }}</div>
                                </div>
                            </div>
                        </div>

                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-clipboard-check"></i>
                                Coverage Instructions
                            </div>
                            <div class="info-item">
                                <div class="info-label">Clinical Coverage Notes</div>
                                <div class="info-value" :class="absenceDetailsModal.absence.coverage_instructions ? '' : 'unavailable'">
                                    {{ absenceDetailsModal.absence.coverage_instructions || 'No specific coverage instructions provided' }}
                                </div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Emergency Contact Protocol</div>
                                <div class="info-value" :class="absenceDetailsModal.absence.emergency_protocol ? '' : 'unavailable'">
                                    {{ absenceDetailsModal.absence.emergency_protocol || 'Standard emergency protocols apply' }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Timeline Tab -->
                    <div v-if="absenceDetailsModal.activeTab === 'timeline'" class="modal-tab-content active" role="tabpanel">
                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-stream"></i>
                                Absence Timeline
                            </div>
                            <div class="activity-timeline" style="position: relative; padding-left: 30px;">
                                <div style="position: absolute; left: 7px; top: 0; bottom: 0; width: 2px; background: var(--medical-light-blue);"></div>
                                
                                <div class="timeline-item" style="position: relative; padding-bottom: 25px;">
                                    <div style="position: absolute; left: -24px; top: 0; width: 16px; height: 16px; border-radius: 50%; background: var(--medical-blue); border: 3px solid white; box-shadow: 0 0 0 2px var(--medical-blue);"></div>
                                    <div style="background: var(--medical-light-blue); padding: 12px; border-radius: var(--border-radius-md); margin-bottom: 4px;">
                                        <div style="font-weight: 600; color: var(--medical-dark-blue);">Absence Documented</div>
                                        <div style="font-size: 13px; color: var(--medical-gray);">{{ formatDateTime(absenceDetailsModal.absence.created_at) }}</div>
                                    </div>
                                </div>

                                <div class="timeline-item" style="position: relative; padding-bottom: 25px;">
                                    <div style="position: absolute; left: -24px; top: 0; width: 16px; height: 16px; border-radius: 50%; background: var(--medical-teal); border: 3px solid white; box-shadow: 0 0 0 2px var(--medical-teal);"></div>
                                    <div style="background: var(--medical-light-blue); padding: 12px; border-radius: var(--border-radius-md); margin-bottom: 4px;">
                                        <div style="font-weight: 600; color: var(--medical-dark-blue);">Absence Period</div>
                                        <div style="font-size: 13px; color: var(--medical-gray);">
                                            {{ formatDate(absenceDetailsModal.absence.start_date) }} to {{ formatDate(absenceDetailsModal.absence.end_date) }}
                                            <span class="badge status-busy" style="margin-left: 8px;">{{ calculateAbsenceDuration(absenceDetailsModal.absence.start_date, absenceDetailsModal.absence.end_date) }} days</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="timeline-item" style="position: relative; padding-bottom: 25px;">
                                    <div style="position: absolute; left: -24px; top: 0; width: 16px; height: 16px; border-radius: 50%; background: var(--medical-green); border: 3px solid white; box-shadow: 0 0 0 2px var(--medical-green);"></div>
                                    <div style="background: var(--medical-light-blue); padding: 12px; border-radius: var(--border-radius-md); margin-bottom: 4px;">
                                        <div style="font-weight: 600; color: var(--medical-dark-blue);">Coverage Arranged</div>
                                        <div style="font-size: 13px; color: var(--medical-gray);" v-if="absenceDetailsModal.absence.replacement_staff_id">
                                            {{ getStaffName(absenceDetailsModal.absence.replacement_staff_id) }} assigned
                                        </div>
                                        <div style="font-size: 13px; color: var(--medical-gray);" v-else>
                                            No coverage assigned yet
                                        </div>
                                    </div>
                                </div>

                                <div class="timeline-item" style="position: relative;">
                                    <div style="position: absolute; left: -24px; top: 0; width: 16px; height: 16px; border-radius: 50%; background: var(--medical-orange); border: 3px solid white; box-shadow: 0 0 0 2px var(--medical-orange);"></div>
                                    <div style="background: var(--medical-light-blue); padding: 12px; border-radius: var(--border-radius-md);">
                                        <div style="font-weight: 600; color: var(--medical-dark-blue);">Current Status</div>
                                        <div style="font-size: 13px; color: var(--medical-gray);">
                                            <span class="badge" :class="getAbsenceStatusClass(absenceDetailsModal.absence.status)" style="margin-right: 8px;">
                                                {{ formatAbsenceStatus(absenceDetailsModal.absence.status) }}
                                            </span>
                                            {{ getAbsenceTimelineStatus(absenceDetailsModal.absence) }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="absenceDetailsModal.show = false">Close</button>
                    <button class="btn btn-primary" @click="editAbsence(absenceDetailsModal.absence)"
                            v-if="hasPermission('staff_absence', 'update')">
                        <i class="fas fa-edit"></i> Edit Absence
                    </button>
                    <button class="btn btn-success" @click="assignCoverage(absenceDetailsModal.absence)"
                            v-if="hasPermission('staff_absence', 'update') && !absenceDetailsModal.absence.replacement_staff_id">
                        <i class="fas fa-user-md"></i> Assign Coverage
                    </button>
                </div>
            </div>
        </div>

        <!-- Import/Export Modal -->
        <div v-if="importExportModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="import-export-title">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title" id="import-export-title">
                        <i class="fas" :class="importExportModal.mode === 'import' ? 'fa-upload' : 'fa-download'"></i>
                        {{ importExportModal.mode === 'import' ? 'Import Data' : 'Export Data' }}
                    </div>
                    <button class="modal-close" @click="importExportModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-database"></i>
                            Data Management
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Select Dataset</label>
                            <select class="form-select" v-model="importExportModal.selectedTable" aria-required="true">
                                <option value="">Select dataset to {{ importExportModal.mode === 'import' ? 'import into' : 'export from' }}</option>
                                <option value="medical_staff">Medical Staff</option>
                                <option value="departments">Departments</option>
                                <option value="clinical_units">Clinical Units</option>
                                <option value="training_units">Training Units</option>
                                <option value="resident_rotations">Resident Rotations</option>
                                <option value="oncall_schedule">On-call Schedule</option>
                                <option value="staff_absence">Staff Absence</option>
                                <option value="audit_logs">Audit Logs</option>
                                <option value="communications">Communications</option>
                                <option value="permissions">Permission Settings</option>
                            </select>
                        </div>
                        
                        <div v-if="importExportModal.mode === 'export'" class="form-group">
                            <label class="form-label">Export Format</label>
                            <select class="form-select" v-model="importExportModal.exportFormat" aria-required="true">
                                <option value="csv">CSV (Comma Separated Values)</option>
                                <option value="json">JSON (JavaScript Object Notation)</option>
                                <option value="excel">Excel Spreadsheet (.xlsx)</option>
                                <option value="pdf">PDF Document</option>
                            </select>
                        </div>
                        
                        <div v-if="importExportModal.mode === 'import'" class="form-group">
                            <label class="form-label">Upload File</label>
                            <div style="border: 2px dashed var(--medical-blue); border-radius: var(--border-radius-md); padding: 32px; text-align: center; background: var(--medical-light-blue); cursor: pointer;" 
                                 @click="triggerFileInput" @dragover.prevent @drop="handleFileDrop">
                                <input type="file" ref="fileInput" style="display: none;" @change="handleFileSelect" 
                                       :accept="getFileAccept()">
                                <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: var(--medical-blue); margin-bottom: 16px;"></i>
                                <div style="font-weight: 600; color: var(--medical-dark-blue); margin-bottom: 8px;">Drop file here or click to browse</div>
                                <div style="font-size: 14px; color: var(--medical-gray);">Supported formats: CSV, JSON, Excel (.xlsx)</div>
                                <div v-if="importExportModal.selectedFile" style="margin-top: 16px; padding: 12px; background: white; border-radius: var(--border-radius-md); border: 1px solid var(--medical-blue);">
                                    <div style="display: flex; align-items: center; justify-content: space-between;">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <i class="fas fa-file" style="color: var(--medical-blue);"></i>
                                            <span style="font-weight: 500;">{{ importExportModal.selectedFile.name }}</span>
                                            <span style="font-size: 12px; color: var(--medical-gray);">({{ formatFileSize(importExportModal.selectedFile.size) }})</span>
                                        </div>
                                        <button class="btn btn-sm btn-outline-danger" @click="clearSelectedFile" style="padding: 4px 8px;">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div v-if="importExportModal.mode === 'import'" class="form-group">
                            <label class="form-check">
                                <input type="checkbox" class="form-check-input" v-model="importExportModal.overwriteExisting">
                                <span class="form-check-label">Overwrite existing records with matching IDs</span>
                            </label>
                        </div>

                        <div v-if="importExportModal.mode === 'import'" class="form-group">
                            <label class="form-check">
                                <input type="checkbox" class="form-check-input" v-model="importExportModal.skipInvalidRows">
                                <span class="form-check-label">Skip invalid rows and continue import</span>
                            </label>
                        </div>

                        <div v-if="importExportModal.mode === 'export'" class="form-group">
                            <label class="form-label">Date Range (Optional)</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                <input type="date" class="form-control" v-model="importExportModal.dateRange.start" placeholder="Start date">
                                <input type="date" class="form-control" v-model="importExportModal.dateRange.end" placeholder="End date">
                            </div>
                        </div>

                        <div v-if="importExportModal.mode === 'export'" class="form-group">
                            <label class="form-check">
                                <input type="checkbox" class="form-check-input" v-model="importExportModal.includeMetadata">
                                <span class="form-check-label">Include metadata (export date, user, total records)</span>
                            </label>
                        </div>
                    </div>

                    <div v-if="importExportModal.mode === 'import'" class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-cogs"></i>
                            Import Settings
                        </div>
                        <div class="form-group">
                            <label class="form-label">Field Mapping</label>
                            <div style="background: var(--medical-light-blue); padding: 16px; border-radius: var(--border-radius-md);">
                                <div style="font-size: 13px; color: var(--medical-gray); margin-bottom: 8px;">Map CSV columns to database fields:</div>
                                <div v-for="(field, index) in importExportModal.fieldMapping" :key="index" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; align-items: center; margin-bottom: 8px;">
                                    <input type="text" class="form-control form-control-sm" v-model="field.csvColumn" placeholder="CSV column name">
                                    <select class="form-select form-select-sm" v-model="field.dbField">
                                        <option value="">Select database field</option>
                                        <option v-for="dbField in getAvailableFields(importExportModal.selectedTable)" :key="dbField" :value="dbField">{{ dbField }}</option>
                                    </select>
                                </div>
                                <button class="btn btn-sm btn-primary" @click="addFieldMapping">
                                    <i class="fas fa-plus"></i> Add Field Mapping
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="importExportModal.show = false">Cancel</button>
                    <button v-if="importExportModal.mode === 'export'" class="btn btn-primary" @click="exportData" :disabled="saving || !importExportModal.selectedTable">
                        <span v-if="saving" class="loading"></span>
                        <span v-else><i class="fas fa-download"></i> Export Data</span>
                    </button>
                    <button v-if="importExportModal.mode === 'import'" class="btn btn-primary" @click="importData" 
                            :disabled="saving || !importExportModal.selectedTable || !importExportModal.selectedFile">
                        <span v-if="saving" class="loading"></span>
                        <span v-else><i class="fas fa-upload"></i> Import Data</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Enhanced Rotation Details Modal -->
        <div v-if="rotationDetailsModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="rotation-details-title">
            <div class="modal-container modal-xwide">
                <div class="modal-header">
                    <div class="modal-title" id="rotation-details-title">
                        <i class="fas fa-calendar-alt"></i>
                        Rotation Details
                    </div>
                    <button class="modal-close" @click="rotationDetailsModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="staff-profile-header">
                        <div class="staff-avatar-large" aria-hidden="true">{{ getInitials(getResidentName(rotationDetailsModal.rotation.resident_id)) }}</div>
                        <div class="staff-basic-info">
                            <div class="staff-name">{{ getResidentName(rotationDetailsModal.rotation.resident_id) }}</div>
                            <div class="staff-title">{{ getTrainingUnitName(rotationDetailsModal.rotation.training_unit_id) }}</div>
                            <span class="staff-status" :class="getRotationStatusClass(rotationDetailsModal.rotation.status)">
                                {{ formatRotationStatus(rotationDetailsModal.rotation.status) }}
                            </span>
                        </div>
                    </div>

                    <div class="staff-stats">
                        <div class="staff-stat-card">
                            <div class="staff-stat-value">{{ formatDate(rotationDetailsModal.rotation.start_date) }}</div>
                            <div class="staff-stat-label">Start Date</div>
                        </div>
                        <div class="staff-stat-card">
                            <div class="staff-stat-value">{{ formatDate(rotationDetailsModal.rotation.end_date) }}</div>
                            <div class="staff-stat-label">End Date</div>
                        </div>
                        <div class="staff-stat-card">
                            <div class="staff-stat-value">{{ calculateRotationDuration(rotationDetailsModal.rotation.start_date, rotationDetailsModal.rotation.end_date) }}</div>
                            <div class="staff-stat-label">Duration</div>
                        </div>
                        <div class="staff-stat-card">
                            <div class="staff-stat-value">{{ getSupervisorName(rotationDetailsModal.rotation.supervisor_id) || 'Not assigned' }}</div>
                            <div class="staff-stat-label">Supervisor</div>
                        </div>
                    </div>

                    <div class="modal-tabs" role="tablist">
                        <button class="modal-tab" :class="{ active: rotationDetailsModal.activeTab === 'details' }" 
                                @click="rotationDetailsModal.activeTab = 'details'" role="tab" aria-selected="rotationDetailsModal.activeTab === 'details'">
                            <i class="fas fa-info-circle"></i> Rotation Details
                        </button>
                        <button class="modal-tab" :class="{ active: rotationDetailsModal.activeTab === 'evaluation' }" 
                                @click="rotationDetailsModal.activeTab = 'evaluation'" role="tab" aria-selected="rotationDetailsModal.activeTab === 'evaluation'">
                            <i class="fas fa-chart-line"></i> Evaluation
                        </button>
                        <button class="modal-tab" :class="{ active: rotationDetailsModal.activeTab === 'documents' }" 
                                @click="rotationDetailsModal.activeTab = 'documents'" role="tab" aria-selected="rotationDetailsModal.activeTab === 'documents'">
                            <i class="fas fa-file-medical"></i> Documents
                        </button>
                        <button class="modal-tab" :class="{ active: rotationDetailsModal.activeTab === 'activity' }" 
                                @click="rotationDetailsModal.activeTab = 'activity'" role="tab" aria-selected="rotationDetailsModal.activeTab === 'activity'">
                            <i class="fas fa-history"></i> Activity Log
                        </button>
                    </div>

                    <!-- Details Tab -->
                    <div v-if="rotationDetailsModal.activeTab === 'details'" class="modal-tab-content active" role="tabpanel">
                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-graduation-cap"></i>
                                Rotation Information
                            </div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <div class="info-label">Rotation ID</div>
                                    <div class="info-value">{{ rotationDetailsModal.rotation.rotation_id || 'N/A' }}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Rotation Type</div>
                                    <div class="info-value">{{ formatRotationType(rotationDetailsModal.rotation.rotation_type) }}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Training Level</div>
                                    <div class="info-value">{{ getResidentTrainingLevel(rotationDetailsModal.rotation.resident_id) }}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Department</div>
                                    <div class="info-value">{{ getRotationDepartment(rotationDetailsModal.rotation) }}</div>
                                </div>
                            </div>
                        </div>

                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-bullseye"></i>
                                Rotation Goals & Objectives
                            </div>
                            <div class="info-item">
                                <div class="info-label">Learning Objectives</div>
                                <div class="info-value" :class="rotationDetailsModal.rotation.goals ? '' : 'unavailable'">
                                    {{ rotationDetailsModal.rotation.goals || 'No specific goals defined' }}
                                </div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Key Competencies</div>
                                <div class="info-value" :class="rotationDetailsModal.rotation.competencies ? '' : 'unavailable'">
                                    {{ rotationDetailsModal.rotation.competencies || 'Standard competencies apply' }}
                                </div>
                            </div>
                        </div>

                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-calendar-check"></i>
                                Schedule & Milestones
                            </div>
                            <div class="capacity-grid">
                                <div v-for="milestone in rotationDetailsModal.milestones" :key="milestone.id" class="capacity-card">
                                    <div class="capacity-card-header">
                                        <div class="capacity-unit">{{ milestone.title }}</div>
                                        <div class="capacity-status" :class="milestone.status">{{ milestone.status }}</div>
                                    </div>
                                    <div style="font-size: 13px; color: var(--medical-gray); margin-top: 8px;">
                                        Due: {{ formatDate(milestone.due_date) }}
                                    </div>
                                    <div style="font-size: 12px; color: var(--medical-dark-blue); margin-top: 4px;">
                                        {{ milestone.description }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Evaluation Tab -->
                    <div v-if="rotationDetailsModal.activeTab === 'evaluation'" class="modal-tab-content active" role="tabpanel">
                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-star"></i>
                                Performance Evaluation
                            </div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <div class="info-label">Overall Score</div>
                                    <div class="info-value">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <div style="font-size: 32px; font-weight: 700; color: var(--medical-blue);">
                                                {{ rotationDetailsModal.rotation.evaluation_score || 'N/A' }}
                                            </div>
                                            <div style="flex: 1;">
                                                <div class="progress-bar" style="height: 10px;">
                                                    <div class="progress-fill" :style="{ width: `${rotationDetailsModal.rotation.evaluation_score || 0}%` }"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Evaluation Status</div>
                                    <div class="info-value">
                                        <span class="badge" :class="getEvaluationStatusClass(rotationDetailsModal.rotation.evaluation_status)">
                                            {{ formatEvaluationStatus(rotationDetailsModal.rotation.evaluation_status) }}
                                        </span>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Last Evaluated</div>
                                    <div class="info-value">{{ rotationDetailsModal.rotation.last_evaluated ? formatDateTime(rotationDetailsModal.rotation.last_evaluated) : 'Not evaluated' }}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Evaluated By</div>
                                    <div class="info-value">{{ rotationDetailsModal.rotation.evaluated_by ? getSupervisorName(rotationDetailsModal.rotation.evaluated_by) : 'Not evaluated' }}</div>
                                </div>
                            </div>
                        </div>

                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-chart-bar"></i>
                                Competency Assessment
                            </div>
                            <div class="capacity-grid">
                                <div v-for="competency in rotationDetailsModal.competencies" :key="competency.id" class="capacity-card">
                                    <div class="capacity-card-header">
                                        <div class="capacity-unit">{{ competency.name }}</div>
                                        <div class="capacity-status" :class="getCompetencyLevelClass(competency.level)">
                                            {{ competency.level }}
                                        </div>
                                    </div>
                                    <div class="progress-bar" style="margin-top: 8px;">
                                        <div class="progress-fill" :style="{ width: `${competency.score}%` }"></div>
                                    </div>
                                    <div style="font-size: 12px; color: var(--medical-gray); margin-top: 4px;">
                                        {{ competency.comments }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-comment-medical"></i>
                                Supervisor Feedback
                            </div>
                            <div class="info-item">
                                <div class="info-label">Strengths</div>
                                <div class="info-value" :class="rotationDetailsModal.rotation.strengths_feedback ? '' : 'unavailable'">
                                    {{ rotationDetailsModal.rotation.strengths_feedback || 'No strengths feedback provided' }}
                                </div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Areas for Improvement</div>
                                <div class="info-value" :class="rotationDetailsModal.rotation.improvement_feedback ? '' : 'unavailable'">
                                    {{ rotationDetailsModal.rotation.improvement_feedback || 'No improvement feedback provided' }}
                                </div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Overall Comments</div>
                                <div class="info-value" :class="rotationDetailsModal.rotation.supervisor_comments ? '' : 'unavailable'">
                                    {{ rotationDetailsModal.rotation.supervisor_comments || 'No supervisor comments' }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Documents Tab -->
                    <div v-if="rotationDetailsModal.activeTab === 'documents'" class="modal-tab-content active" role="tabpanel">
                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-folder-open"></i>
                                Rotation Documents
                            </div>
                            <div class="training-units-grid">
                                <div v-for="document in rotationDetailsModal.documents" :key="document.id" class="training-unit-card">
                                    <div class="training-unit-header">
                                        <div>
                                            <div class="training-unit-title">{{ document.name }}</div>
                                            <div class="training-unit-capacity">{{ formatFileSize(document.size) }}  {{ formatDocumentType(document.type) }}</div>
                                        </div>
                                        <span class="badge" :class="getDocumentStatusClass(document.status)">
                                            {{ document.status }}
                                        </span>
                                    </div>
                                    
                                    <div style="font-size: 14px; color: var(--medical-gray); margin-bottom: 16px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                        {{ document.description || 'No description available' }}
                                    </div>
                                    
                                    <div style="display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: var(--medical-gray);">
                                        <span>Uploaded: {{ formatTimeAgo(document.uploaded_at) }}</span>
                                        <span>By: {{ document.uploaded_by }}</span>
                                    </div>
                                    
                                    <div class="flex gap-2 mt-4">
                                        <button class="btn btn-sm btn-primary flex-1" @click="downloadDocument(document)">
                                            <i class="fas fa-download"></i> Download
                                        </button>
                                        <button class="btn btn-sm btn-secondary" @click="previewDocument(document)">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-upload"></i>
                                Upload New Document
                            </div>
                            <div style="border: 2px dashed var(--medical-blue); border-radius: var(--border-radius-md); padding: 24px; text-align: center; background: var(--medical-light-blue);">
                                <input type="file" ref="rotationDocInput" style="display: none;" @change="handleRotationDocumentUpload" multiple>
                                <i class="fas fa-cloud-upload-alt" style="font-size: 36px; color: var(--medical-blue); margin-bottom: 12px;"></i>
                                <div style="font-weight: 600; color: var(--medical-dark-blue); margin-bottom: 8px;">Drop documents here or click to browse</div>
                                <div style="font-size: 13px; color: var(--medical-gray); margin-bottom: 16px;">Supported: PDF, DOC, DOCX, images</div>
                                <button class="btn btn-primary" @click="triggerRotationDocumentUpload">
                                    <i class="fas fa-plus"></i> Select Documents
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Activity Tab -->
                    <div v-if="rotationDetailsModal.activeTab === 'activity'" class="modal-tab-content active" role="tabpanel">
                        <div class="info-section">
                            <div class="info-section-title">
                                <i class="fas fa-stream"></i>
                                Rotation Activity Log
                            </div>
                            <div style="max-height: 400px; overflow-y: auto;">
                                <div v-for="activity in rotationDetailsModal.activity" :key="activity.id" style="padding: 16px; border-bottom: 1px solid var(--medical-light-blue);">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                                        <div style="font-weight: 600; color: var(--medical-dark-blue);">{{ activity.action }}</div>
                                        <div style="font-size: 12px; color: var(--medical-gray);">{{ formatTimeAgo(activity.timestamp) }}</div>
                                    </div>
                                    <div style="font-size: 14px; color: var(--medical-gray); margin-bottom: 4px;">{{ activity.description }}</div>
                                    <div v-if="activity.details" style="font-size: 13px; color: var(--medical-blue); background: var(--medical-light-blue); padding: 8px; border-radius: var(--border-radius-sm); margin-top: 4px;">
                                        {{ activity.details }}
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px; font-size: 12px; color: var(--medical-gray);">
                                        <span>By: {{ activity.user_name }}</span>
                                        <span>IP: {{ activity.ip_address }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="rotationDetailsModal.show = false">Close</button>
                    <button class="btn btn-primary" @click="editRotation(rotationDetailsModal.rotation)"
                            v-if="hasPermission('resident_rotations', 'update')">
                        <i class="fas fa-edit"></i> Edit Rotation
                    </button>
                    <button class="btn btn-success" @click="generateRotationReport(rotationDetailsModal.rotation)"
                            v-if="hasPermission('resident_rotations', 'export')">
                        <i class="fas fa-file-pdf"></i> Generate Report
                    </button>
                </div>
            </div>
        </div>

        <!-- Drag and Drop Modal for Dashboard Customization -->
        <div v-if="dashboardCustomizeModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="dashboard-customize-title">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title" id="dashboard-customize-title">
                        <i class="fas fa-th-large"></i>
                        Customize Dashboard
                    </div>
                    <button class="modal-close" @click="dashboardCustomizeModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-sliders-h"></i>
                            Dashboard Layout
                        </div>
                        <p style="color: var(--medical-gray); margin-bottom: 16px;">Drag and drop widgets to rearrange your dashboard. Check/uncheck to show/hide widgets.</p>
                        
                        <div style="background: var(--medical-light-blue); padding: 16px; border-radius: var(--border-radius-md);">
                            <div v-for="widget in dashboardCustomizeModal.availableWidgets" :key="widget.id" 
                                 style="display: flex; align-items: center; padding: 12px; background: white; border-radius: var(--border-radius-md); margin-bottom: 8px; border: 2px solid var(--medical-light-blue); cursor: move;"
                                 draggable="true"
                                 @dragstart="startWidgetDrag($event, widget.id)"
                                 @dragend="endWidgetDrag">
                                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                                    <div style="width: 32px; height: 32px; border-radius: var(--border-radius-sm); background: linear-gradient(135deg, var(--medical-blue), var(--medical-dark-blue)); display: flex; align-items: center; justify-content: center; color: white;">
                                        <i :class="widget.icon"></i>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--medical-dark-blue);">{{ widget.title }}</div>
                                        <div style="font-size: 12px; color: var(--medical-gray);">{{ widget.description }}</div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <label class="form-check" style="margin: 0;">
                                        <input type="checkbox" class="form-check-input" v-model="widget.visible" style="margin: 0;">
                                        <span class="form-check-label" style="font-size: 13px;">Show</span>
                                    </label>
                                    <div style="display: flex; gap: 4px;">
                                        <button class="btn btn-sm btn-icon btn-secondary" @click="moveWidgetUp(widget.id)" style="width: 32px; height: 32px;">
                                            <i class="fas fa-arrow-up"></i>
                                        </button>
                                        <button class="btn btn-sm btn-icon btn-secondary" @click="moveWidgetDown(widget.id)" style="width: 32px; height: 32px;">
                                            <i class="fas fa-arrow-down"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-palette"></i>
                            Appearance Settings
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Card Density</label>
                                <select class="form-select" v-model="dashboardCustomizeModal.appearance.cardDensity">
                                    <option value="compact">Compact</option>
                                    <option value="normal">Normal</option>
                                    <option value="comfortable">Comfortable</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Color Theme</label>
                                <select class="form-select" v-model="dashboardCustomizeModal.appearance.colorTheme">
                                    <option value="medical">Medical Blue</option>
                                    <option value="light">Light Theme</option>
                                    <option value="dark">Dark Theme</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Font Size</label>
                                <select class="form-select" v-model="dashboardCustomizeModal.appearance.fontSize">
                                    <option value="small">Small</option>
                                    <option value="medium">Medium</option>
                                    <option value="large">Large</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Animation Speed</label>
                                <select class="form-select" v-model="dashboardCustomizeModal.appearance.animationSpeed">
                                    <option value="fast">Fast</option>
                                    <option value="normal">Normal</option>
                                    <option value="slow">Slow</option>
                                    <option value="none">None</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-bell"></i>
                            Notification Preferences
                        </div>
                        <div class="form-group">
                            <label class="form-check">
                                <input type="checkbox" class="form-check-input" v-model="dashboardCustomizeModal.notifications.showAlerts">
                                <span class="form-check-label">Show emergency alerts on dashboard</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="form-check">
                                <input type="checkbox" class="form-check-input" v-model="dashboardCustomizeModal.notifications.showNotifications">
                                <span class="form-check-label">Show notification badges</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="form-check">
                                <input type="checkbox" class="form-check-input" v-model="dashboardCustomizeModal.notifications.autoRefresh">
                                <span class="form-check-label">Auto-refresh dashboard data</span>
                            </label>
                        </div>
                        <div v-if="dashboardCustomizeModal.notifications.autoRefresh" class="form-group">
                            <label class="form-label">Refresh Interval</label>
                            <select class="form-select" v-model="dashboardCustomizeModal.notifications.refreshInterval">
                                <option value="30">30 seconds</option>
                                <option value="60">1 minute</option>
                                <option value="300">5 minutes</option>
                                <option value="600">10 minutes</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="dashboardCustomizeModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="resetDashboardLayout">
                        <i class="fas fa-redo"></i> Reset to Default
                    </button>
                    <button class="btn btn-success" @click="saveDashboardCustomization" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else><i class="fas fa-save"></i> Save Changes</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Advanced Search Modal -->
        <div v-if="advancedSearchModal.show" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="advanced-search-title">
            <div class="modal-container modal-wide">
                <div class="modal-header">
                    <div class="modal-title" id="advanced-search-title">
                        <i class="fas fa-search-plus"></i>
                        Advanced Search
                    </div>
                    <button class="modal-close" @click="advancedSearchModal.show = false" aria-label="Close modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-tabs" role="tablist">
                        <button class="modal-tab" :class="{ active: advancedSearchModal.activeTab === 'medical_staff' }" 
                                @click="advancedSearchModal.activeTab = 'medical_staff'" role="tab" aria-selected="advancedSearchModal.activeTab === 'medical_staff'">
                            <i class="fas fa-user-md"></i> Medical Staff
                        </button>
                        <button class="modal-tab" :class="{ active: advancedSearchModal.activeTab === 'rotations' }" 
                                @click="advancedSearchModal.activeTab = 'rotations'" role="tab" aria-selected="advancedSearchModal.activeTab === 'rotations'">
                            <i class="fas fa-calendar-alt"></i> Rotations
                        </button>
                        <button class="modal-tab" :class="{ active: advancedSearchModal.activeTab === 'absence' }" 
                                @click="advancedSearchModal.activeTab = 'absence'" role="tab" aria-selected="advancedSearchModal.activeTab === 'absence'">
                            <i class="fas fa-calendar-times"></i> Absence Records
                        </button>
                        <button class="modal-tab" :class="{ active: advancedSearchModal.activeTab === 'documents' }" 
                                @click="advancedSearchModal.activeTab = 'documents'" role="tab" aria-selected="advancedSearchModal.activeTab === 'documents'">
                            <i class="fas fa-file-medical"></i> Documents
                        </button>
                    </div>

                    <!-- Medical Staff Search Tab -->
                    <div v-if="advancedSearchModal.activeTab === 'medical_staff'" class="modal-tab-content active" role="tabpanel">
                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-filter"></i>
                                Search Filters
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">Name Contains</label>
                                    <input type="text" class="form-control" v-model="advancedSearchModal.filters.medical_staff.name" placeholder="Full name or partial name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Staff Type</label>
                                    <select class="form-select" v-model="advancedSearchModal.filters.medical_staff.staff_type" multiple style="height: 120px;">
                                        <option value="medical_resident">Medical Resident</option>
                                        <option value="attending_physician">Attending Physician</option>
                                        <option value="fellow">Fellow</option>
                                        <option value="nurse_practitioner">Nurse Practitioner</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Department</label>
                                    <select class="form-select" v-model="advancedSearchModal.filters.medical_staff.department_id">
                                        <option value="">All Departments</option>
                                        <option v-for="department in departments" :key="department.id" :value="department.id">
                                            {{ department.name }}
                                        </option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Employment Status</label>
                                    <select class="form-select" v-model="advancedSearchModal.filters.medical_staff.employment_status">
                                        <option value="">All Statuses</option>
                                        <option value="active">Active</option>
                                        <option value="on_leave">On Leave</option>
                                        <option value="inactive">Inactive</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Date Range (Join Date)</label>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                        <input type="date" class="form-control" v-model="advancedSearchModal.filters.medical_staff.join_date_start" placeholder="Start date">
                                        <input type="date" class="form-control" v-model="advancedSearchModal.filters.medical_staff.join_date_end" placeholder="End date">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Training Level (Residents only)</label>
                                    <select class="form-select" v-model="advancedSearchModal.filters.medical_staff.training_level">
                                        <option value="">All Levels</option>
                                        <option value="pgy1">PGY-1</option>
                                        <option value="pgy2">PGY-2</option>
                                        <option value="pgy3">PGY-3</option>
                                        <option value="pgy4">PGY-4</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-sort-amount-down"></i>
                                Sort & Display Options
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">Sort By</label>
                                    <select class="form-select" v-model="advancedSearchModal.sort.medical_staff.field">
                                        <option value="full_name">Name</option>
                                        <option value="staff_id">Staff ID</option>
                                        <option value="staff_type">Staff Type</option>
                                        <option value="employment_status">Status</option>
                                        <option value="join_date">Join Date</option>
                                        <option value="last_activity">Last Active</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Sort Order</label>
                                    <select class="form-select" v-model="advancedSearchModal.sort.medical_staff.order">
                                        <option value="asc">Ascending</option>
                                        <option value="desc">Descending</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Results Per Page</label>
                                    <select class="form-select" v-model="advancedSearchModal.display.medical_staff.resultsPerPage">
                                        <option value="10">10 results</option>
                                        <option value="25">25 results</option>
                                        <option value="50">50 results</option>
                                        <option value="100">100 results</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-check">
                                        <input type="checkbox" class="form-check-input" v-model="advancedSearchModal.display.medical_staff.showInactive">
                                        <span class="form-check-label">Include inactive staff</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Rotations Search Tab -->
                    <div v-if="advancedSearchModal.activeTab === 'rotations'" class="modal-tab-content active" role="tabpanel">
                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-filter"></i>
                                Rotation Search Filters
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">Resident Name</label>
                                    <input type="text" class="form-control" v-model="advancedSearchModal.filters.rotations.resident_name" placeholder="Resident name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Training Unit</label>
                                    <select class="form-select" v-model="advancedSearchModal.filters.rotations.training_unit_id">
                                        <option value="">All Units</option>
                                        <option v-for="unit in trainingUnits" :key="unit.id" :value="unit.id">
                                            {{ unit.name }}
                                        </option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Rotation Status</label>
                                    <select class="form-select" v-model="advancedSearchModal.filters.rotations.status">
                                        <option value="">All Statuses</option>
                                        <option value="active">Active</option>
                                        <option value="upcoming">Upcoming</option>
                                        <option value="completed">Completed</option>
                                        <option value="cancelled">Cancelled</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Supervisor</label>
                                    <select class="form-select" v-model="advancedSearchModal.filters.rotations.supervisor_id">
                                        <option value="">All Supervisors</option>
                                        <option v-for="supervisor in availableSupervisors" :key="supervisor.id" :value="supervisor.id">
                                            {{ supervisor.full_name }}
                                        </option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Date Range</label>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                        <input type="date" class="form-control" v-model="advancedSearchModal.filters.rotations.date_start" placeholder="Start date">
                                        <input type="date" class="form-control" v-model="advancedSearchModal.filters.rotations.date_end" placeholder="End date">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Minimum Duration (weeks)</label>
                                    <input type="number" class="form-control" v-model="advancedSearchModal.filters.rotations.min_duration" min="1" max="52" placeholder="Minimum weeks">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional search tabs would follow the same pattern -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="advancedSearchModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="clearAdvancedSearch">
                        <i class="fas fa-eraser"></i> Clear Filters
                    </button>
                    <button class="btn btn-success" @click="performAdvancedSearch" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else><i class="fas fa-search"></i> Search</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal -->
<div v-if="confirmationModal && confirmationModal.show" class="modal-overlay" role="dialog" aria-modal="true" 
     aria-labelledby="confirmation-title" aria-describedby="confirmation-message">
    <div class="modal-container" style="max-width: 500px;">
        <div class="modal-header">
            <div class="modal-title" id="confirmation-title">
                <i class="fas" :class="confirmationModal.icon || 'fa-question-circle'"></i>
                {{ confirmationModal.title || 'Confirm Action' }}
            </div>
            <button class="modal-close" @click="cancelConfirmation" aria-label="Close confirmation dialog">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <p id="confirmation-message" style="text-align: center; margin: 20px 0; font-size: 16px; color: var(--gray-700); line-height: 1.5;">
                {{ confirmationModal.message || 'Are you sure you want to proceed?' }}
            </p>
            <div v-if="confirmationModal.details" style="background: var(--medical-light-blue); padding: 16px; border-radius: var(--border-radius-md); margin-top: 16px; font-size: 14px; color: var(--medical-dark-blue);">
                <i class="fas fa-info-circle" style="margin-right: 8px;"></i>
                {{ confirmationModal.details }}
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" @click="cancelConfirmation" :disabled="saving">
                {{ confirmationModal.cancelButtonText || 'Cancel' }}
            </button>
            <button class="btn" :class="confirmationModal.confirmButtonClass || 'btn-danger'" @click="confirmAction" :disabled="saving">
                <template v-if="saving">
                    <span class="loading-spinner" style="display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite;"></span>
                </template>
                <template v-else>
                    <i :class="confirmationModal.confirmButtonIcon || 'fa-check'" style="margin-right: 8px;"></i>
                    {{ confirmationModal.confirmButtonText || 'Confirm' }}
                </template>
            </button>
        </div>
    </div>
</div>
<!-- Load the main Vue application logic -->
<script src="app.js"></script>
 <!-- Safety check -->
    <script>
        // Safety check - make sure dependencies are loaded
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof Vue === 'undefined') {
                console.error('Vue.js failed to load!');
                alert('Vue.js failed to load. Please refresh the page.');
            }
            if (typeof supabase === 'undefined') {
                console.warn('Supabase not loaded - using mock data');
            }
        });
    </script>
</body>
</html>
